---
phase: 02-security-hardening
plan: 03
type: execute
depends_on: ["02-02"]
files_modified: [ADVISORI Sanity Migration/fetch-model-governance.ts, ADVISORI Sanity Migration/verify-model-governance-en.ts, ADVISORI Sanity Migration/create-model-governance-en.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch1.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch2.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch3.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch4.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch5.ts, ADVISORI Sanity Migration/fetch-mifid-rts.ts]
---

<objective>
Validate that all credentials are removed, fix scripts with wrong project ID, and verify scripts still function correctly.

Purpose: Confirm the security hardening is complete and nothing is broken. Fix the 9 scripts that reference the wrong Sanity project ID.
Output: All scripts use correct credentials from environment, zero exposed tokens, representative scripts verified working.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/02-security-hardening/02-01-SUMMARY.md
@.planning/phases/02-security-hardening/02-02-SUMMARY.md
@.planning/phases/01-audit-assessment/01-01-SUMMARY.md

**Constraining decisions:**
- Phase 1 identified 9 scripts with wrong project ID `b0o7vqwz` (should be `wwmm9rbb`)
- Affected files (from 01-01 summary): fetch-model-governance.ts, verify-model-governance-en.ts, model-governance-en-faqs-batch1-5.ts, create-model-governance-en.ts, fetch-mifid-rts.ts
- The correct project ID is `wwmm9rbb`
- check-existing-en-pages.ts and check-kyc-en.ts were confirmed working in Phase 1
- Scripts run via `npx tsx <filename>` from the ADVISORI Sanity Migration/ directory
- ONLY run read-only scripts (check-*.ts, verify-*.ts) for testing — NEVER run create/import/fix scripts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix wrong project ID in 9 affected scripts</name>
  <files>ADVISORI Sanity Migration/fetch-model-governance.ts, ADVISORI Sanity Migration/verify-model-governance-en.ts, ADVISORI Sanity Migration/create-model-governance-en.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch1.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch2.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch3.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch4.ts, ADVISORI Sanity Migration/model-governance-en-faqs-batch5.ts, ADVISORI Sanity Migration/fetch-mifid-rts.ts</files>
  <action>
  1. Read each of the 9 identified files and confirm they contain `b0o7vqwz` as the projectId
  2. Replace `b0o7vqwz` with `wwmm9rbb` in each file
  3. While in these files, also verify the token replacement from Plan 02-02 was applied correctly
  4. If any additional files are discovered with `b0o7vqwz` during a broader search, fix those too

  Search the entire codebase for `b0o7vqwz` to catch any files not identified in the Phase 1 audit:
  - `ADVISORI Sanity Migration/` (excluding node_modules/)
  - `de-pages-created/`
  - Project root

  Also check if any files have other incorrect project IDs (anything other than `wwmm9rbb` in a projectId field).
  </action>
  <verify>
  1. Grep entire project for `b0o7vqwz` — should return 0 matches
  2. All 9 files now have `wwmm9rbb` as projectId
  3. Spot-check that token replacement is also correct in these files
  </verify>
  <done>All scripts reference correct Sanity project ID wwmm9rbb. Zero instances of b0o7vqwz remain.</done>
</task>

<task type="auto">
  <name>Task 2: Comprehensive credential scan and functional verification</name>
  <files>.planning/phases/02-security-hardening/02-03-SUMMARY.md</files>
  <action>
  **Part A: Credential scan**

  1. Search the ENTIRE project for the full hardcoded token string `[REDACTED-TOKEN]` across ALL files (excluding node_modules/ and .env)
     - Expected: 0 matches
     - If matches found: document which files and fix them

  2. Search for partial token patterns that might indicate incomplete replacement:
     - `skNQVXst` (first 8 chars of token)
     - `0hC5oPfb` (last 8 chars of token)
     - Exclude .env files and node_modules/ from search

  3. Search for any other credential-like patterns:
     - Other `sk` prefixed strings that look like Sanity tokens (long alphanumeric strings after `token:`)
     - Hardcoded API keys in any format

  4. Verify .gitignore is working:
     - Run `git status` and confirm .env files do NOT appear as untracked
     - Confirm .gitignore is properly excluding credential files

  **Part B: Functional verification**

  5. Run a read-only check script to verify it can connect to Sanity using env vars:
     - Execute `npx tsx check-existing-en-pages.ts` from `ADVISORI Sanity Migration/` directory
     - This script already used dotenv before our changes — it should work as before
     - Capture output — should return Sanity data

  6. Run a previously-hardcoded script that was just modified to use dotenv:
     - Pick one check-*.ts file that was modified in Plan 02-02 (e.g., check-kyc-en.ts)
     - Execute with `npx tsx`
     - Verify it successfully connects and returns data

  7. If any script fails: diagnose whether it's a dotenv path issue, missing import, or other problem. Fix and re-test.

  ONLY run read-only scripts (check-*, verify-*). Do NOT run create-*, import-*, or fix-* scripts.
  </action>
  <verify>
  1. Full token string scan returns 0 matches (excluding .env and node_modules/)
  2. Partial token scan returns 0 matches (excluding .env and node_modules/)
  3. .env files are excluded from git tracking
  4. At least 2 scripts tested and working (one pre-existing dotenv, one newly converted)
  </verify>
  <done>Zero exposed credentials in codebase. Scripts verified working with environment variables. Security hardening complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Zero instances of hardcoded token in any .ts file (excluding node_modules/, .env)
- [ ] Zero instances of wrong project ID b0o7vqwz
- [ ] .gitignore properly excludes .env files
- [ ] At least 2 representative scripts tested and confirmed working with env vars
- [ ] No other credential-like strings found in codebase scan
</verification>

<success_criteria>

- Complete credential elimination verified by comprehensive scan
- Wrong project IDs fixed across all affected scripts
- Representative scripts confirmed working after modifications
- Phase 2 Security Hardening is fully complete
- PROJECT.md and STATE.md updated to reflect Phase 2 completion
</success_criteria>

<output>
After completion, create `.planning/phases/02-security-hardening/02-03-SUMMARY.md`

Also update:
- `.planning/STATE.md` — Phase 2 complete, update progress to 20%
- `.planning/PROJECT.md` — Mark "Fix critical security issues" as complete in Active requirements
</output>
