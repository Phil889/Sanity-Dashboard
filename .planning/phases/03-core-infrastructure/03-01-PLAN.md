---
phase: 03-core-infrastructure
plan: 01
type: execute
depends_on: []
files_modified: [package.json, tsconfig.json, src/lib/.gitkeep]
---

<objective>
Set up project foundation with root-level package.json, TypeScript configuration, and shared module directory structure.

Purpose: Establish the build and module system that all subsequent pipeline code (Phases 4-10) depends on. Currently there is no package.json at the project root, no tsconfig.json anywhere, and no shared module structure — every script is standalone.
Output: Working TypeScript project with root package.json, tsconfig.json, and src/lib/ directory ready for shared modules.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key context from prior phases:
# - No package.json at project root (only in ADVISORI Sanity Migration/de-pages-created/)
# - node_modules exist in ADVISORI Sanity Migration/ with @sanity/client, dotenv, ts-node, typescript
# - Scripts run via globally-installed tsx command
# - .env at project root has SANITY_PROJECT_ID, SANITY_DATASET, SANITY_API_VERSION, SANITY_API_TOKEN
# - .gitignore at project root (created Phase 2)
# - 637 existing standalone scripts remain untouched — new pipeline code goes in src/

**Tech stack available:** @sanity/client ^7.2.1, dotenv ^16.5.0, TypeScript, tsx (global)
**Established patterns:** dotenv for env vars, process.env.SANITY_API_TOKEN, kebab-case files, camelCase functions
**Constraining decisions:**
- Phase 2: All credentials via environment variables with dotenv
- Phase 2: Fallback project IDs use correct `wwmm9rbb`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root-level package.json with dependencies and scripts</name>
  <files>package.json</files>
  <action>Create package.json at the project root (`ADVISORI Sanity Migration - english/`). Include:
  - name: "advisori-sanity-pipeline"
  - version: "0.1.0"
  - private: true
  - type: "module" (use ESM — modern Node.js, aligns with tsx usage)
  - scripts: "build" (tsc), "typecheck" (tsc --noEmit)
  - dependencies: @sanity/client (^7.2.1), dotenv (^16.5.0)
  - devDependencies: typescript (^5.0.0), @types/node (^20.0.0), tsx (^4.0.0)

  Do NOT copy node_modules from ADVISORI Sanity Migration/. Run `npm install` at project root to create a fresh node_modules.

  Do NOT add a "start" script yet — specific entry points will be added in later phases.

  Why type: "module": Enables native ESM imports, which @sanity/client v7 expects. tsx handles both ESM and CJS transparently.</action>
  <verify>npm install completes without errors. `node -e "require('./package.json')"` or `cat package.json` shows correct structure.</verify>
  <done>package.json exists at project root with correct dependencies. npm install succeeded. node_modules created at root level.</done>
</task>

<task type="auto">
  <name>Task 2: Create tsconfig.json and src/lib/ directory structure</name>
  <files>tsconfig.json, src/lib/.gitkeep</files>
  <action>Create tsconfig.json at the project root with:
  - compilerOptions.target: "ES2022"
  - compilerOptions.module: "Node16" (for ESM + Node.js interop)
  - compilerOptions.moduleResolution: "Node16"
  - compilerOptions.outDir: "./dist"
  - compilerOptions.rootDir: "./src"
  - compilerOptions.strict: true
  - compilerOptions.esModuleInterop: true
  - compilerOptions.skipLibCheck: true
  - compilerOptions.forceConsistentCasingInFileNames: true
  - compilerOptions.resolveJsonModule: true
  - compilerOptions.declaration: true
  - compilerOptions.declarationMap: true
  - compilerOptions.sourceMap: true
  - include: ["src/**/*"]
  - exclude: ["node_modules", "dist", "ADVISORI Sanity Migration"]

  Exclude "ADVISORI Sanity Migration" to avoid TypeScript errors from the 637 existing standalone scripts — they have their own implicit config and are not part of the new pipeline.

  Create directory structure:
  - src/lib/ (shared modules — sanity client, config, errors, logger)
  - src/ root will later contain pipeline scripts (Phases 4-10)

  Add a .gitkeep in src/lib/ so git tracks the empty directory.

  Verify TypeScript compilation works: run `npx tsc --noEmit` (should pass with 0 errors on empty src/).</action>
  <verify>`npx tsc --noEmit` completes with 0 errors. `ls src/lib/` shows the directory exists.</verify>
  <done>tsconfig.json exists with strict settings. src/lib/ directory exists. TypeScript compiler runs without errors.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] package.json exists at project root with correct dependencies
- [ ] npm install succeeded (node_modules at root)
- [ ] tsconfig.json exists with strict TypeScript settings
- [ ] src/lib/ directory exists
- [ ] `npx tsc --noEmit` passes with 0 errors
- [ ] Existing scripts in ADVISORI Sanity Migration/ are unaffected
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors introduced
- Project has a working TypeScript build system
- Directory structure ready for shared modules
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-infrastructure/03-01-SUMMARY.md`
</output>
