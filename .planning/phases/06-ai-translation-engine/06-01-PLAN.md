---
phase: 06-ai-translation-engine
plan: 01
title: Translation Infrastructure and Glossary
depends_on: []
estimated_duration: 15min
strategy: A
files_modified:
  - package.json
  - src/lib/config.ts
  - .env.example
  - src/lib/translation-types.ts (new)
  - src/lib/glossary.ts (new)
---

# Plan 06-01: Translation Infrastructure and Glossary

## Objective

Set up the foundational infrastructure for AI-assisted translation: install the Anthropic SDK, extend configuration to support Claude API credentials, define the TypeScript output types for translated pages, and create a glossary module for consistent slug translation and terminology.

## Context

Phase 5 outputs `ExtractedPage` JSON files (German content, system fields stripped). Phase 6 must translate these into English servicePage documents ready for Sanity upload. This plan establishes the types, config, and terminology consistency system that the translation engine (06-02) will consume.

### Input contract (from Phase 5)

```typescript
// ExtractedPage: German servicePage with _id, _type, title, slug, language:"de",
// heroSection, overview, approach, services[], faq[], seo, testimonial, parent, references
```

### Output contract (Phase 6 → Phase 7/8)

The TranslatedPage type defined here will be the contract. It mirrors ExtractedPage but with:
- `_id`: `${germanId}-en`
- `language`: `'en'`
- `slug.current`: English path segments + `-en` suffix
- `__i18n_lang`: `'en'`
- `__i18n_base`: `{ _ref: germanId, _type: 'reference' }`
- All text fields translated to English
- All `_key` values regenerated with new timestamps
- `seo.title`: translated + ` | ADVISORI` appended

### Glossary requirements

From the audit (01-03-SUMMARY.md), existing translations show:
- AI-embellished buzzwords ("AI-powered", "revolutionize", "cutting-edge") that must be forbidden
- Inconsistent slug segment translations
- Some fictional testimonial content

The glossary provides:
1. **Slug segment translation map** — consistent DE→EN for the ~20 known parent path segments
2. **Forbidden terms** — marketing buzzwords the AI must NOT add
3. **Domain terminology** — financial/regulatory terms that should be kept consistent

## Tasks

### Task 1: Install Anthropic SDK and extend configuration

**Do:**
1. Install `@anthropic-ai/sdk` as a production dependency:
   ```bash
   npm install @anthropic-ai/sdk
   ```
2. Add `ANTHROPIC_API_KEY` to `.env.example` with a placeholder comment
3. Extend `src/lib/config.ts`:
   - Add `AnthropicConfig` interface with `apiKey` and `model` fields
   - Add `anthropic` section to the `Config` interface
   - Read `ANTHROPIC_API_KEY` from env (required) and `ANTHROPIC_MODEL` (optional, default `claude-sonnet-4-5-20250514`)
   - Validate `ANTHROPIC_API_KEY` is present (throw ConfigError if missing)

**Verify:**
- `npm run typecheck` passes
- `ANTHROPIC_API_KEY` is validated on import (set to dummy value in test)

### Task 2: Create translation types

**Do:**
Create `src/lib/translation-types.ts` with:

1. **`TranslatedPage`** interface — extends the structure of `ExtractedPageSchema` from `extraction-types.ts` but represents the English output:
   - Same field structure as ExtractedPageSchema
   - Additional fields: `__i18n_lang: string`, `__i18n_base: { _ref: string, _type: string }`
   - Language is `'en'` (not `'de'`)

2. **`TranslationResult`** interface:
   - `translatedPage: TranslatedPage`
   - `germanId: string`
   - `slug: string`
   - `model: string` (which Claude model was used)
   - `inputTokens: number`
   - `outputTokens: number`
   - `durationMs: number`

3. **`TranslationConfig`** interface:
   - `model: string`
   - `maxTokens: number` (default 8192)
   - `temperature: number` (default 0.3 — low for translation consistency)

**Verify:**
- `npm run typecheck` passes
- Types are importable from other modules

### Task 3: Create glossary module

**Do:**
Create `src/lib/glossary.ts` with:

1. **`SLUG_TRANSLATIONS`** — `Record<string, string>` mapping German slug segments to English:
   ```typescript
   {
     'informationssicherheit': 'information-security',
     'digitale-transformation': 'digital-transformation',
     'prozessautomatisierung': 'process-automation',
     'risikomanagement': 'risk-management',
     'regulatory-compliance-management': 'regulatory-compliance-management',
     // ... ~20 known segments from existing translations
   }
   ```

2. **`translateSlug(germanSlug: string): string`** — function that:
   - Splits slug by `/`
   - Translates each segment using the lookup table (pass-through if not found)
   - Appends `-en` to the final segment
   - Returns the full English slug path

3. **`FORBIDDEN_TERMS`** — `string[]` of marketing buzzwords the AI must NOT add:
   ```typescript
   ['AI-powered', 'revolutionize', 'cutting-edge', 'game-changing', 'world-class', ...]
   ```

4. **`DOMAIN_TERMS`** — `Record<string, string>` of German→English domain terms for consistent translation:
   ```typescript
   {
     'Geldwäschegesetz': 'Anti-Money Laundering Act (GwG)',
     'Sorgfaltspflichten': 'due diligence obligations',
     // financial/regulatory terms
   }
   ```

5. **`generateKey(prefix: string, index: number): string`** — standardized key generation:
   ```typescript
   `${prefix}_${Date.now()}_${index}`
   ```
   This replaces the 4 inconsistent patterns found in the audit.

**Verify:**
- `translateSlug('informationssicherheit/kritis/meldepflichten')` returns `'information-security/kritis/meldepflichten-en'`
- `translateSlug('risikomanagement/non-financial-risk/kyc')` returns `'risk-management/non-financial-risk/kyc-en'`
- `generateKey('benefit', 1)` returns a string matching pattern `benefit_\d+_1`
- `npm run typecheck` passes

## Verification

- [ ] `@anthropic-ai/sdk` installed in package.json dependencies
- [ ] `ANTHROPIC_API_KEY` in .env.example
- [ ] config.ts validates ANTHROPIC_API_KEY on import
- [ ] TranslatedPage type defined with __i18n_lang and __i18n_base fields
- [ ] TranslationResult type includes token counts and duration
- [ ] SLUG_TRANSLATIONS covers known parent segments from existing translations
- [ ] translateSlug() correctly translates segments and appends -en
- [ ] FORBIDDEN_TERMS list exists
- [ ] generateKey() produces consistent key format
- [ ] `npm run typecheck` passes

## Output

- `package.json` — @anthropic-ai/sdk added
- `src/lib/config.ts` — anthropic config section added
- `.env.example` — ANTHROPIC_API_KEY placeholder added
- `src/lib/translation-types.ts` — TranslatedPage, TranslationResult, TranslationConfig
- `src/lib/glossary.ts` — slug translations, forbidden terms, domain terms, generateKey
