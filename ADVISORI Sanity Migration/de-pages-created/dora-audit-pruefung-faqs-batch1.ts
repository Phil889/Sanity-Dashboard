import 'dotenv/config'
import { createClient } from '@sanity/client'

// Create client with direct credentials
const client = createClient({
  projectId: 'wwmm9rbb',
  dataset: 'production',
  apiVersion: '2024-02-14',
  token: process.env.SANITY_API_TOKEN,
  useCdn: false,
})

// Helper function to generate unique keys
function generateKey(prefix: string, index: number): string {
  return `${prefix}_${Date.now()}_${index}`
}

const run = async () => {
  try {
    console.log('Updating DORA Audit & Pr√ºfung page with FAQ batch 1...')
    
    // First, get the existing document
    console.log('Fetching existing document...')
    const existingDoc = await client.fetch('*[_id == $id][0]', { id: 'dora-audit-pruefung' })
    
    if (!existingDoc) {
      throw new Error('Document "dora-audit-pruefung" not found')
    }
    
    // Create new FAQs for DORA audit fundamentals
    const newFaqs = [
      {
        _type: 'object',
        _key: generateKey('faq', 1),
        question: 'Was sind die grundlegenden DORA-Audit-Anforderungen und wie unterscheiden sie sich von traditionellen IT-Audits?',
        answer: "DORA-Audits stellen eine neue Generation von Compliance-Pr√ºfungen dar, die speziell auf die digitale operationelle Resilienz von Finanzinstituten ausgerichtet sind. Sie gehen weit √ºber traditionelle IT-Audits hinaus und integrieren regulatorische Compliance mit operationeller Effektivit√§t in einem ganzheitlichen Ansatz.\n\nüéØ Spezifische DORA-Audit-Schwerpunkte:\n‚Ä¢ DORA-Audits fokussieren auf die Bewertung der gesamten digitalen operationellen Resilienz, nicht nur auf einzelne IT-Systeme oder Sicherheitskontrollen\n‚Ä¢ Sie bewerten die Wirksamkeit von IKT-Risikomanagement-Frameworks und deren Integration in die Gesch√§ftsstrategie\n‚Ä¢ Besondere Aufmerksamkeit gilt der Bewertung kritischer IKT-Drittanbieter und deren Auswirkungen auf die operative Kontinuit√§t\n‚Ä¢ Die Audits pr√ºfen die Angemessenheit von Incident-Response-Prozessen und Business-Continuity-Pl√§nen unter realistischen Stressbedingungen\n‚Ä¢ Compliance mit spezifischen DORA-Berichtspflichten und Dokumentationsanforderungen steht im Mittelpunkt\n\nüîç Methodologische Unterschiede zu traditionellen IT-Audits:\n‚Ä¢ DORA-Audits verwenden einen risikobasierten Ansatz, der die Kritikalit√§t von IKT-Services f√ºr die Gesch√§ftskontinuit√§t bewertet\n‚Ä¢ Sie integrieren Threat-Intelligence und Szenario-basierte Bewertungen zur Pr√ºfung der Resilienz gegen verschiedene St√∂rungsarten\n‚Ä¢ Die Audits bewerten nicht nur technische Kontrollen, sondern auch Governance-Strukturen und Entscheidungsprozesse\n‚Ä¢ Kontinuierliche Monitoring-F√§higkeiten und Real-Time-Risikobewertung werden systematisch gepr√ºft\n‚Ä¢ Cross-funktionale Zusammenarbeit zwischen IT, Risk Management und Business wird explizit bewertet\n\nüìä Regulatorische Integration und Compliance-Fokus:\n‚Ä¢ DORA-Audits m√ºssen die Einhaltung spezifischer regulatorischer Anforderungen validieren, die in traditionellen IT-Audits nicht existieren\n‚Ä¢ Sie bewerten die Angemessenheit von Reporting-Mechanismen gegen√ºber Aufsichtsbeh√∂rden\n‚Ä¢ Die Audits pr√ºfen die Implementierung von DORA-spezifischen Governance-Anforderungen und Management-Verantwortlichkeiten\n‚Ä¢ Compliance mit Penetrationstest-Anforderungen und deren Integration in das Risikomanagement wird systematisch bewertet\n‚Ä¢ Die Wirksamkeit von Drittanbieter-Risikomanagement-Prozessen unter DORA-Gesichtspunkten steht im Fokus\n\nüåê Ganzheitlicher Resilienz-Ansatz:\n‚Ä¢ DORA-Audits bewerten die End-to-End-Resilienz von Gesch√§ftsprozessen, nicht nur die technische Verf√ºgbarkeit von Systemen\n‚Ä¢ Sie pr√ºfen die F√§higkeit zur schnellen Wiederherstellung und Anpassung an ver√§nderte Betriebsbedingungen\n‚Ä¢ Die Audits bewerten die Integration von Cyber-Resilienz in die strategische Planung und Entscheidungsfindung\n‚Ä¢ Organisatorische Lernf√§higkeit und kontinuierliche Verbesserung der Resilienz-Ma√ünahmen werden systematisch gepr√ºft\n‚Ä¢ Die Wirksamkeit von Kommunikations- und Koordinationsmechanismen w√§hrend St√∂rungen wird bewertet"
      },
      {
        _type: 'object',
        _key: generateKey('faq', 2),
        question: 'Wie bereite ich mein Finanzinstitut optimal auf ein DORA-Audit vor und welche Dokumentation ist erforderlich?',
        answer: "Eine erfolgreiche DORA-Audit-Vorbereitung erfordert eine systematische und umfassende Herangehensweise, die weit √ºber die Sammlung von Dokumenten hinausgeht. Sie umfasst die strategische Ausrichtung der gesamten Organisation auf die Demonstration operationeller Resilienz und regulatorischer Compliance.\n\nüìã Strategische Audit-Vorbereitung:\n‚Ä¢ Entwickeln Sie eine umfassende DORA-Compliance-Roadmap, die alle Anforderungsbereiche abdeckt und den aktuellen Implementierungsstand transparent darstellt\n‚Ä¢ Etablieren Sie ein dediziertes DORA-Compliance-Team mit klaren Verantwortlichkeiten und Berichtswegen\n‚Ä¢ F√ºhren Sie eine Pre-Audit-Selbstbewertung durch, um potenzielle Schwachstellen und Verbesserungsbereiche zu identifizieren\n‚Ä¢ Entwickeln Sie Narrative und Erkl√§rungen f√ºr komplexe technische und organisatorische Zusammenh√§nge\n‚Ä¢ Bereiten Sie Management-Pr√§sentationen vor, die die strategische Bedeutung der operationellen Resilienz verdeutlichen\n\nüìö Umfassende Dokumentationsanforderungen:\n‚Ä¢ IKT-Risikomanagement-Framework mit detaillierter Beschreibung von Governance-Strukturen, Rollen und Verantwortlichkeiten\n‚Ä¢ Vollst√§ndiges Inventar aller kritischen IKT-Systeme, -Services und -Abh√§ngigkeiten mit Risikobewertungen\n‚Ä¢ Dokumentation aller Drittanbieter-Beziehungen einschlie√ülich Vertr√§ge, SLAs und Risikobewertungen\n‚Ä¢ Incident-Response-Pl√§ne, Business-Continuity-Strategien und Disaster-Recovery-Verfahren mit Testprotokollen\n‚Ä¢ Penetrationstest-Berichte, Vulnerability-Assessments und Remediation-Pl√§ne der letzten Jahre\n\nüîß Operative Vorbereitungsma√ünahmen:\n‚Ä¢ Stellen Sie sicher, dass alle kritischen Systeme und Prozesse ordnungsgem√§√ü dokumentiert und ihre Abh√§ngigkeiten kartiert sind\n‚Ä¢ Validieren Sie die Funktionsf√§higkeit aller Backup- und Recovery-Systeme durch aktuelle Tests\n‚Ä¢ √úberpr√ºfen Sie die Vollst√§ndigkeit und Aktualit√§t aller Incident-Logs und deren Analyse\n‚Ä¢ Bereiten Sie Demonstrationen kritischer Sicherheits- und Resilienz-Kontrollen vor\n‚Ä¢ Schulen Sie alle relevanten Mitarbeiter in DORA-Anforderungen und deren praktischer Umsetzung\n\nüéØ Audit-spezifische Vorbereitung:\n‚Ä¢ Entwickeln Sie einen detaillierten Audit-Ablaufplan mit Zeitpl√§nen, Verantwortlichkeiten und Eskalationsprozessen\n‚Ä¢ Bereiten Sie einen dedizierten Audit-Raum mit allen notwendigen technischen Ressourcen vor\n‚Ä¢ Stellen Sie sicher, dass alle Audit-relevanten Systeme und Daten w√§hrend der Pr√ºfung verf√ºgbar sind\n‚Ä¢ Entwickeln Sie Kommunikationsprotokolle f√ºr die Interaktion mit Auditoren\n‚Ä¢ Bereiten Sie Backup-Pl√§ne f√ºr den Fall technischer Probleme oder unvorhergesehener Ereignisse vor\n\nüìà Kontinuierliche Verbesserung und Follow-up:\n‚Ä¢ Etablieren Sie Prozesse zur kontinuierlichen √úberwachung der DORA-Compliance zwischen den Audits\n‚Ä¢ Entwickeln Sie Mechanismen zur schnellen Identifikation und Behebung von Compliance-L√ºcken\n‚Ä¢ Implementieren Sie regelm√§√üige interne Audits und Selbstbewertungen\n‚Ä¢ Schaffen Sie Feedback-Schleifen zur kontinuierlichen Verbesserung der Audit-Bereitschaft\n‚Ä¢ Planen Sie proaktive Updates der Dokumentation und Prozesse basierend auf regulatorischen Entwicklungen"
      },
      {
        _type: 'object',
        _key: generateKey('faq', 3),
        question: 'Welche Rolle spielen Penetrationstests und technische Assessments in DORA-Audits?',
        answer: "Penetrationstests und technische Assessments sind zentrale Komponenten von DORA-Audits und gehen weit √ºber traditionelle Sicherheitstests hinaus. Sie dienen als kritische Validierungsinstrumente f√ºr die operative Resilienz und m√ºssen in einen umfassenden Risikomanagement-Kontext eingebettet werden.\n\nüéØ DORA-spezifische Penetrationstest-Anforderungen:\n‚Ä¢ DORA verlangt regelm√§√üige, risikobasierte Penetrationstests, die nicht nur technische Schwachstellen, sondern auch operative Auswirkungen bewerten\n‚Ä¢ Die Tests m√ºssen realistische Angriffszenarien simulieren, die speziell auf Finanzdienstleistungen ausgerichtet sind\n‚Ä¢ Threat-Intelligence-basierte Testans√§tze sind erforderlich, um aktuelle und relevante Bedrohungen zu ber√ºcksichtigen\n‚Ä¢ Die Tests m√ºssen sowohl interne als auch externe Perspektiven abdecken und verschiedene Angriffsvektoren einbeziehen\n‚Ä¢ Red-Team-Exercises und Purple-Team-Aktivit√§ten werden zunehmend als Best Practice erwartet\n\nüîç Umfassende technische Assessment-Bereiche:\n‚Ä¢ Bewertung der Cybersecurity-Posture aller kritischen IKT-Systeme und deren Widerstandsf√§higkeit gegen verschiedene Angriffsarten\n‚Ä¢ Analyse der Netzwerksegmentierung und deren Wirksamkeit bei der Eind√§mmung von Sicherheitsvorf√§llen\n‚Ä¢ Bewertung von Identity- und Access-Management-Systemen sowie deren Integration in die Gesamtsicherheitsarchitektur\n‚Ä¢ Pr√ºfung der Wirksamkeit von Monitoring- und Detection-Systemen unter realistischen Angriffsbedingungen\n‚Ä¢ Assessment der Backup- und Recovery-Systeme einschlie√ülich deren Sicherheit gegen Ransomware-Angriffe\n\nüìä Integration in das Risikomanagement:\n‚Ä¢ Penetrationstest-Ergebnisse m√ºssen systematisch in die IKT-Risikobewertung integriert und deren Auswirkungen auf die Gesch√§ftskontinuit√§t bewertet werden\n‚Ä¢ Die Tests m√ºssen dokumentieren, wie identifizierte Schwachstellen die operative Resilienz beeintr√§chtigen k√∂nnten\n‚Ä¢ Remediation-Pl√§ne m√ºssen priorisiert werden basierend auf der Kritikalit√§t f√ºr die Gesch√§ftsoperationen\n‚Ä¢ Follow-up-Tests m√ºssen die Wirksamkeit implementierter Gegenma√ünahmen validieren\n‚Ä¢ Die Ergebnisse m√ºssen in verst√§ndlicher Form an das Management und die Aufsichtsgremien kommuniziert werden\n\nüõ°Ô∏è Kontinuierliche Sicherheitsbewertung:\n‚Ä¢ DORA erwartet nicht nur periodische Tests, sondern auch kontinuierliche Sicherheits√ºberwachung und -bewertung\n‚Ä¢ Vulnerability-Management-Prozesse m√ºssen systematisch implementiert und deren Wirksamkeit regelm√§√üig validiert werden\n‚Ä¢ Threat-Hunting-Aktivit√§ten und proaktive Sicherheitsanalysen werden zunehmend erwartet\n‚Ä¢ Die Integration von Threat-Intelligence in die laufende Sicherheitsbewertung ist ein kritischer Erfolgsfaktor\n‚Ä¢ Automatisierte Sicherheitstests und kontinuierliche Compliance-Checks m√ºssen etabliert werden\n\nüé™ Audit-Validierung und Berichterstattung:\n‚Ä¢ Auditoren werden die Angemessenheit der Test-Methodologien und deren Ausrichtung auf die spezifischen Risiken des Instituts bewerten\n‚Ä¢ Die Vollst√§ndigkeit der Test-Abdeckung und die Ber√ºcksichtigung aller kritischen Systeme und Prozesse wird gepr√ºft\n‚Ä¢ Die Qualit√§t der Remediation-Prozesse und deren Nachverfolgung steht im Fokus der Audit-Bewertung\n‚Ä¢ Die Integration der Test-Ergebnisse in strategische Entscheidungen und Investitionspl√§ne wird bewertet\n‚Ä¢ Die Kommunikation der Testergebnisse an relevante Stakeholder und deren Verwendung f√ºr kontinuierliche Verbesserung wird validiert"
      },
      {
        _type: 'object',
        _key: generateKey('faq', 4),
        question: 'Wie gestalte ich ein effektives internes DORA-Audit-Programm und welche Ressourcen sind erforderlich?',
        answer: "Ein effektives internes DORA-Audit-Programm ist ein strategisches Instrument zur kontinuierlichen Gew√§hrleistung der operationellen Resilienz und regulatorischen Compliance. Es erfordert eine durchdachte Struktur, angemessene Ressourcen und eine klare Integration in die bestehenden Governance-Frameworks.\n\nüèóÔ∏è Strategische Programm-Architektur:\n‚Ä¢ Entwickeln Sie ein risikobasiertes Audit-Framework, das die spezifischen DORA-Anforderungen mit den individuellen Risikoprofilen Ihres Instituts verkn√ºpft\n‚Ä¢ Etablieren Sie einen mehrj√§hrigen Audit-Plan, der alle kritischen Bereiche systematisch abdeckt und Flexibilit√§t f√ºr Ad-hoc-Pr√ºfungen bietet\n‚Ä¢ Integrieren Sie das DORA-Audit-Programm in bestehende Three-Lines-of-Defense-Modelle und stellen Sie klare Abgrenzungen sicher\n‚Ä¢ Definieren Sie spezifische Audit-Ziele, die √ºber reine Compliance hinausgehen und Wertsch√∂pfung f√ºr die Organisation schaffen\n‚Ä¢ Schaffen Sie Verbindungen zu anderen Audit-Bereichen wie Operational Risk, IT-Audit und Compliance-Monitoring\n\nüë• Ressourcen und Kompetenzanforderungen:\n‚Ä¢ Stellen Sie sicher, dass Ihr Audit-Team sowohl technische IKT-Expertise als auch regulatorisches Know-how besitzt\n‚Ä¢ Investieren Sie in kontinuierliche Weiterbildung zu DORA-Entwicklungen, Cyber-Threats und neuen Technologien\n‚Ä¢ Entwickeln Sie interne Audit-Methodologien und -Tools, die speziell auf DORA-Anforderungen zugeschnitten sind\n‚Ä¢ Etablieren Sie Partnerschaften mit externen Spezialisten f√ºr hochspezialisierte technische Assessments\n‚Ä¢ Schaffen Sie ausreichende Kapazit√§ten f√ºr sowohl geplante als auch ungeplante Audit-Aktivit√§ten\n\nüìã Audit-Methodologie und -Prozesse:\n‚Ä¢ Entwickeln Sie standardisierte Audit-Programme f√ºr verschiedene DORA-Bereiche, die gleichzeitig Flexibilit√§t f√ºr spezifische Risiken bieten\n‚Ä¢ Implementieren Sie datengetriebene Audit-Ans√§tze, die kontinuierliche Monitoring-Daten und Analytics nutzen\n‚Ä¢ Etablieren Sie klare Audit-Kriterien und Bewertungsma√üst√§be, die objektive und nachvollziehbare Ergebnisse gew√§hrleisten\n‚Ä¢ Entwickeln Sie effiziente Dokumentations- und Berichtsprozesse, die sowohl interne als auch regulatorische Anforderungen erf√ºllen\n‚Ä¢ Implementieren Sie Follow-up-Prozesse, die die Wirksamkeit von Remediation-Ma√ünahmen systematisch validieren\n\nüîÑ Kontinuierliche Verbesserung und Innovation:\n‚Ä¢ Etablieren Sie Feedback-Mechanismen, die Erkenntnisse aus Audits in die kontinuierliche Verbesserung der operationellen Resilienz einflie√üen lassen\n‚Ä¢ Nutzen Sie Audit-Ergebnisse zur Identifikation von Trends und systemischen Risiken, die strategische Aufmerksamkeit erfordern\n‚Ä¢ Entwickeln Sie Metriken und KPIs, die die Wirksamkeit des Audit-Programms selbst messen und kontinuierliche Optimierung erm√∂glichen\n‚Ä¢ Implementieren Sie regelm√§√üige Programm-Reviews, die die Angemessenheit und Effektivit√§t des Audit-Ansatzes bewerten\n‚Ä¢ Schaffen Sie Mechanismen zur schnellen Anpassung des Programms an neue regulatorische Entwicklungen oder ver√§nderte Risikoprofile\n\nüéØ Integration und Governance:\n‚Ä¢ Stellen Sie sicher, dass das DORA-Audit-Programm angemessen in die Gesamtstrategie f√ºr operationelle Resilienz integriert ist\n‚Ä¢ Etablieren Sie klare Berichtswege und Kommunikationsmechanismen zu Management und Aufsichtsgremien\n‚Ä¢ Schaffen Sie Koordinationsmechanismen mit anderen Kontrollfunktionen, um Synergien zu nutzen und Doppelarbeit zu vermeiden\n‚Ä¢ Implementieren Sie Quality-Assurance-Prozesse, die die Konsistenz und Qualit√§t der Audit-Arbeit gew√§hrleisten\n‚Ä¢ Entwickeln Sie Eskalationsprozesse f√ºr kritische Findings und systemische Risiken, die sofortige Aufmerksamkeit erfordern"
      }
    ]
    
    // Update the document with new FAQs
    const updatedFaqs = [...(existingDoc.faq || []), ...newFaqs]
    
    console.log(`Adding ${newFaqs.length} new FAQs to the document...`)
    const transaction = client.transaction()
    transaction.patch(existingDoc._id, {
      set: {
        faq: updatedFaqs
      }
    })
    
    await transaction.commit()
    console.log('‚úÖ FAQ batch 1 added successfully')
  } catch (error) {
    console.error('Error:', error)
    throw error
  }
}

run()
