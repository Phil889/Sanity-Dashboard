import 'dotenv/config'
import { createClient } from '@sanity/client'

// Create client with direct credentials
const client = createClient({
  projectId: 'wwmm9rbb',
  dataset: 'production',
  apiVersion: '2024-02-14',
  token: process.env.SANITY_API_TOKEN,
  useCdn: false,
})

// Helper function to generate unique keys
function generateKey(prefix: string, index: number): string {
  return `${prefix}_${Date.now()}_${index}`
}

const run = async () => {
  try {
    console.log('Updating MaRisk Dokumentationsanforderungen page with FAQs batch 3...')
    
    // First, get the existing document
    console.log('Fetching existing document...')
    const existingDoc = await client.fetch('*[_id == $id][0]', { id: 'marisk-dokumentationsanforderungen-prozess-kontrollbeschreibungen' })
    
    if (!existingDoc) {
      throw new Error('Document "marisk-dokumentationsanforderungen-prozess-kontrollbeschreibungen" not found')
    }
    
    // Create new FAQs
    const newFaqs = [
      {
        _type: 'object',
        _key: generateKey('faq', 9),
        question: "Wie können agile Methoden mit den Dokumentationsanforderungen der MaRisk in Einklang gebracht werden und welche Ansätze empfiehlt ADVISORI?",
        answer: "Die Integration agiler Arbeitsweisen mit den stark strukturierten Dokumentationsanforderungen der MaRisk stellt viele Institute vor eine besondere Herausforderung. Die scheinbaren Gegensätze zwischen agiler Flexibilität und regulatorischer Strenge lassen sich jedoch durch einen durchdachten Ansatz überbrücken, der beiden Anforderungen gerecht wird.\n\n* Herausforderungen bei der Kombination von agilen Methoden und regulatorischer Dokumentation:\n• Unterschiedliche Grundprinzipien: Agile Methoden betonen inkrementelle Entwicklung, kontinuierliche Anpassung und minimale Dokumentation, während MaRisk umfassende und formalisierte Dokumentation verlangt.\n• Zeitlicher Aspekt: Agile Prozesse sind auf schnelle Iterationen ausgerichtet, während regulatorische Dokumentation typischerweise als zeitaufwändiger Prozess wahrgenommen wird.\n• Granularität und Formalität: Agile Teams bevorzugen oft flexible, leichtgewichtige Dokumentationsformen, während aufsichtsrechtliche Anforderungen strukturierte und formale Nachweise verlangen.\n• Änderungsdynamik: Die häufigen Änderungen in agilen Projekten können zu einem hohen Aufwand für die Aktualisierung regulatorischer Dokumentation führen.\n• Verantwortlichkeiten: In agilen Teams wird Verantwortung oft gemeinsam getragen, während MaRisk klare individuelle Verantwortlichkeiten fordert.\n\n* Integrationsansätze für agile Methoden und MaRisk-konforme Dokumentation:\n• Dokumentation als User Stories: Integration der Dokumentationsanforderungen als explizite User Stories oder Backlog-Items in agilen Projektmethoden, um sie als gleichwertigen Teil des Entwicklungsprozesses zu behandeln.\n• Kontinuierliche Dokumentation: Einführung eines parallelen, kontinuierlichen Dokumentationsprozesses, der synchron mit der agilen Entwicklung läuft, statt Dokumentation als nachgelagerte Aktivität zu behandeln.\n• Dokumentations-DoD (Definition of Done): Aufnahme spezifischer Dokumentationsanforderungen in die Definition of Done für User Stories und Sprints, um sicherzustellen, dass keine Funktionalität ohne entsprechende Dokumentation als abgeschlossen gilt.\n• Automatisierte Dokumentationsgenerierung: Nutzung von Tools zur automatisierten Extraktion und Generierung von Dokumentationselementen aus Code, Konfiguration und Testfällen, um den manuellen Dokumentationsaufwand zu reduzieren.\n• Dokumentations-Spikes: Planung dedizierter Zeiträume (Spikes) für die Konsolidierung und Formalisierung der Dokumentation nach mehreren Entwicklungssprints.\n\n* ADVISORI-Ansatz für agile MaRisk-Dokumentation:\n• Mehrstufiges Dokumentationsmodell: Wir entwickeln ein Dokumentationsmodell mit verschiedenen Ebenen, von hochgradig formalisierten regulatorischen Dokumenten bis zu agilen Arbeitsdokumenten mit klaren Verbindungen zwischen den Ebenen.\n• Hybrid-Rollen: Etablierung spezialisierter Rollen (z.B. Compliance Engineer, Regulatory Product Owner), die als Brücke zwischen agilen Teams und regulatorischen Anforderungen fungieren.\n• Templates und Checklisten: Bereitstellung anpassbarer Dokumentationsvorlagen und regulatorischer Checklisten, die direkt in agile Workflows und Tools integriert werden können.\n• Risikoorientierter Dokumentationsansatz: Fokussierung des Dokumentationsaufwands auf regulatorisch kritische Aspekte basierend auf einer sorgfältigen Risikoanalyse, um unnötige Dokumentation zu vermeiden.\n• Agile Governance-Struktur: Entwicklung eines Governance-Frameworks, das sowohl agile Prinzipien als auch regulatorische Anforderungen berücksichtigt und klare Eskalationswege für Compliance-Themen definiert."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 10),
        question: "Welche Rolle spielt die Prozess- und Kontrolldokumentation bei Fusionen und Übernahmen, und wie unterstützt ADVISORI bei der Integration unterschiedlicher Dokumentationsstandards?",
        answer: "Bei Fusionen und Übernahmen (M&A) im Finanzsektor stellt die Integration unterschiedlicher Prozess- und Kontrolldokumentationen eine zentrale Herausforderung dar. Eine gründliche Analyse und methodische Harmonisierung der Dokumentation ist entscheidend für den erfolgreichen Zusammenschluss und die Sicherstellung der kontinuierlichen MaRisk-Compliance im fusionierten Institut.\n\n* Dokumentationsrelevante Herausforderungen bei M&A-Transaktionen:\n• Unterschiedliche Dokumentationsstandards: Variierende Formate, Detaillierungsgrade und strukturelle Ansätze in der Prozess- und Kontrolldokumentation der beteiligten Institute.\n• Terminologische Differenzen: Abweichende Begrifflichkeiten und Taxonomien für ähnliche Prozesse, Risiken und Kontrollen, die zu Missverständnissen und Inkonsistenzen führen können.\n• Regulatorische Genehmigungen: Notwendigkeit, eine konsistente und vollständige Dokumentation der kombinierten Prozess- und Kontrolllandschaft für aufsichtsrechtliche Genehmigungen bereitzustellen.\n• Prozessüberschneidungen: Identifikation von Überschneidungen, Lücken und Widersprüchen in den dokumentierten Prozessen und Kontrollen der zusammengeführten Institute.\n• Compliance-Kontinuität: Sicherstellung der unterbrechungsfreien Einhaltung regulatorischer Anforderungen während der Integrationsphase trotz sich ändernder Prozesse und Verantwortlichkeiten.\n\n* Dokumentationsbezogene Aufgaben im M&A-Prozess:\n• Due Diligence: Systematische Analyse und Bewertung der Qualität, Vollständigkeit und Compliance-Konformität der Prozess- und Kontrolldokumentation des Zielinstituts.\n• Gap-Analyse: Identifikation von Unterschieden, Lücken und Überlappungen zwischen den Dokumentationsstandards und -inhalten der beteiligten Institute.\n• Zielbild-Definition: Entwicklung eines gemeinsamen Zielbilds für die integrierte Dokumentationslandschaft, das die Stärken beider Systeme berücksichtigt und regulatorische Anforderungen optimal erfüllt.\n• Migrationsstrategie: Erarbeitung eines strukturierten Plans für die schrittweise Harmonisierung oder Neugestaltung der Dokumentation mit klaren Prioritäten und Meilensteinen.\n• Transitionsmanagement: Sicherstellung der kontinuierlichen Verfügbarkeit essentieller Dokumentation während der Übergangsphase, insbesondere für kritische und stark regulierte Prozesse.\n\n* ADVISORI-Unterstützung bei der Dokumentationsintegration:\n• M&A-spezifische Dokumentations-Due-Diligence: Durchführung einer spezialisierten Due Diligence mit Fokus auf die regulatorische Qualität und Vollständigkeit der Prozess- und Kontrolldokumentation des Zielinstituts.\n• Best-Practice-Synthese: Identifikation und Übernahme der jeweils effektivsten Dokumentationsansätze aus beiden Organisationen für das Zielbild der integrierten Dokumentation.\n• Harmonisierte Taxonomie: Entwicklung einer einheitlichen Terminologie und Klassifikation für Prozesse, Risiken und Kontrollen als Grundlage für die integrierte Dokumentation.\n• Integrationsroadmap: Erstellung eines detaillierten, priorisierten Fahrplans für die schrittweise Harmonisierung der Dokumentation, der operative Notwendigkeiten und regulatorische Anforderungen berücksichtigt.\n• Compliance-Monitoring: Einrichtung eines speziellen Überwachungssystems zur Sicherstellung der kontinuierlichen MaRisk-Konformität während der Dokumentationsintegration."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 11),
        question: "Wie gelingt die optimale Integration der Prozess- und Kontrolldokumentation in das gesamte Governance-Risk-Compliance-Framework (GRC) eines Instituts?",
        answer: "Eine isolierte Betrachtung der Prozess- und Kontrolldokumentation greift zu kurz. Ihr volles Potenzial entfaltet sie erst durch die nahtlose Integration in das übergreifende Governance-Risk-Compliance-Framework (GRC) des Instituts. Diese Integration ermöglicht einen ganzheitlichen Blick auf Risiken und Kontrollen über alle Dimensionen hinweg und schafft Synergien zwischen verschiedenen Compliance-Anforderungen.\n\n* Vorteile einer integrierten GRC-Dokumentation:\n• Vermeidung von Redundanzen: Reduzierung von Mehrfachdokumentationen ähnlicher Kontrollen für verschiedene regulatorische Anforderungen (MaRisk, BAIT, DSGVO, etc.).\n• Konsistente Risikobewertung: Einheitliche Bewertung und Dokumentation von Risiken über verschiedene Compliance-Bereiche hinweg für ein kohärentes Gesamtrisikobild.\n• Transparenz über Kontrolllücken: Identifikation von Bereichen, in denen Kontrollen fehlen oder unzureichend sind, durch die übergreifende Sicht auf das Kontrollsystem.\n• Effizienzgewinne: Reduzierung des Gesamtaufwands für Dokumentationserstellung und -pflege durch Nutzung von Synergien zwischen verschiedenen Compliance-Anforderungen.\n• Verbesserte Entscheidungsgrundlagen: Bereitstellung konsistenter und ganzheitlicher Informationen für Management-Entscheidungen zu Risiken und Kontrollen.\n\n* Integrationsebenen im GRC-Framework:\n• Strategische Integration: Ausrichtung der Prozess- und Kontrolldokumentation an der übergeordneten GRC-Strategie und den strategischen Zielen des Instituts.\n• Organisatorische Integration: Einbindung aller relevanten Funktionen (Prozessmanagement, Risikomanagement, Compliance, Interne Revision) in die Erstellung und Pflege der Dokumentation.\n• Methodische Integration: Harmonisierung der Methoden zur Risikobewertung, Kontrolldesign und Wirksamkeitsprüfung über verschiedene Compliance-Bereiche hinweg.\n• Taxonomische Integration: Entwicklung einer einheitlichen Sprache und Klassifikation für Prozesse, Risiken, Kontrollen und regulatorische Anforderungen.\n• Technologische Integration: Implementierung einer integrierten GRC-Plattform, die alle relevanten Dokumentationselemente verbindet und konsistent verwaltet.\n\n* ADVISORI-Ansatz für eine integrierte GRC-Dokumentation:\n• GRC-Reifegradanalyse: Bewertung des aktuellen Integrationsgrades der Prozess- und Kontrolldokumentation im GRC-Framework und Identifikation von Optimierungspotenzialen.\n• Control Framework Mapping: Systematische Zuordnung von Kontrollen zu verschiedenen regulatorischen Anforderungen (MaRisk, BAIT, DSGVO, etc.) zur Identifikation von Synergien und Lücken.\n• Integrierte Risikotaxonomie: Entwicklung einer übergreifenden Risikotaxonomie, die alle relevanten Risikoarten abdeckt und als gemeinsame Basis für verschiedene Compliance-Bereiche dient.\n• Documentation Control Tower: Etablierung einer zentralen Koordinationsfunktion für die übergreifende Steuerung und Qualitätssicherung der GRC-Dokumentation.\n• Technologie-Roadmap: Erstellung einer Roadmap für die schrittweise technologische Integration der verschiedenen Dokumentationselemente in eine kohärente GRC-Plattform."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 12),
        question: "Welche Ansätze zur Dokumentation komplexer IT-Prozesse und Systemlandschaften sind nach MaRisk erforderlich und wie unterstützt ADVISORI dabei?",
        answer: "Die Dokumentation komplexer IT-Prozesse und Systemlandschaften stellt eine besondere Herausforderung im Rahmen der MaRisk-Compliance dar. Die zunehmende Komplexität, verteilte Architekturen und die Verschränkung von Business- und IT-Prozessen erfordern spezialisierte Dokumentationsansätze, die sowohl technische Details als auch regulatorische Anforderungen berücksichtigen.\n\n* Spezifische Anforderungen an die IT-Prozessdokumentation gemäß MaRisk:\n• Systemlandschaftsdokumentation: Umfassende Darstellung aller relevanten IT-Systeme, ihrer Schnittstellen und Abhängigkeiten gemäß AT 7.2 MaRisk in angemessener Detailtiefe.\n• IT-Prozessbeschreibungen: Detaillierte Dokumentation aller wesentlichen IT-Prozesse, insbesondere für Änderungsmanagement, Notfallmanagement und IT-Betrieb.\n• IT-Risikomanagement: Dokumentation der Identifikation, Bewertung und Adressierung IT-spezifischer Risiken in Übereinstimmung mit dem übergreifenden Risikomanagement.\n• Berechtigungskonzepte: Transparente Dokumentation von Berechtigungsstrukturen, Rollen und Zugriffsrechten gemäß AT 4.3.1 Tz. 2 MaRisk.\n• Notfallkonzepte: Detaillierte Dokumentation von IT-Notfallplänen, Wiederanlaufverfahren und Ausweichlösungen gemäß AT 7.3 MaRisk.\n• Auslagerungen in der IT: Spezifische Dokumentation von IT-Auslagerungen unter Berücksichtigung der besonderen Anforderungen des AT 9 MaRisk und der BAIT.\n\n* Methodische Herausforderungen bei der IT-Dokumentation:\n• Komplexitätsbewältigung: Darstellung hochkomplexer IT-Landschaften und -Prozesse in einer für Fachbereiche und Prüfer verständlichen Form.\n• Aktualität: Sicherstellung der Aktualität der Dokumentation in einem Umfeld mit häufigen Änderungen und kontinuierlicher Weiterentwicklung.\n• Abstraktionsgrade: Festlegung angemessener Detaillierungsgrade für verschiedene Zielgruppen von technischen Experten bis zum Management.\n• Verknüpfung mit Geschäftsprozessen: Herstellung transparenter Verbindungen zwischen IT-Prozessen und den unterstützten Geschäftsprozessen.\n• Technologie-Business-Gap: Überbrückung der Kommunikations- und Verständnislücke zwischen IT und Fachbereichen in der Dokumentation.\n\n* ADVISORI-Lösungsansatz für MaRisk-konforme IT-Dokumentation:\n• Mehrschichtige IT-Architekturmodelle: Entwicklung einer mehrschichtigen Dokumentation der IT-Architektur mit verschiedenen Abstraktionsebenen für unterschiedliche Zielgruppen und Anwendungsfälle.\n• IT-Prozess-Framework: Etablierung eines spezialisierten Frameworks für die Dokumentation von IT-Prozessen, das sowohl MaRisk-Anforderungen als auch IT-Standards (z.B. ITIL, COBIT) berücksichtigt.\n• IT-Risiko-Control-Mapping: Systematische Verbindung von IT-Risiken mit implementierten Kontrollen und deren Dokumentation in einer integrierten Risiko-Kontroll-Matrix.\n• RACI-Modelle für IT-Prozesse: Integration klarer Verantwortlichkeitsstrukturen in die IT-Prozessdokumentation durch detaillierte RACI-Modelle.\n• Automatisierte Dokumentationsgenerierung: Implementierung von Lösungen zur teilautomatisierten Aktualisierung der IT-Systemdokumentation aus CMDB-Daten und anderen IT-Management-Systemen.\n• IT-GRC-Integration: Einbindung der IT-Prozess- und Systemdokumentation in das übergreifende GRC-Framework des Instituts zur ganzheitlichen Steuerung von IT-Risiken und -Compliance."
      }
    ]
    
    // Update the document with new FAQs
    const updatedFaqs = [...(existingDoc.faq || []), ...newFaqs]
    
    console.log(`Adding ${newFaqs.length} new FAQs to the document...`)
    const transaction = client.transaction()
    transaction.patch(existingDoc._id, {
      set: {
        faq: updatedFaqs
      }
    })
    
    await transaction.commit()
    console.log('✅ FAQs batch 3 added successfully')
  } catch (error) {
    console.error('Error:', error)
    throw error
  }
}

run()
