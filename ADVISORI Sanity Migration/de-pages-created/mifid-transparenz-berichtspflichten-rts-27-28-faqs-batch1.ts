import 'dotenv/config'
import { createClient } from '@sanity/client'

// Create client with direct credentials
const client = createClient({
  projectId: 'wwmm9rbb',
  dataset: 'production',
  apiVersion: '2024-02-14',
  token: process.env.SANITY_API_TOKEN,
  useCdn: false,
})

// Helper function to generate unique keys
function generateKey(prefix: string, index: number): string {
  return `${prefix}_${Date.now()}_${index}`
}

const run = async () => {
  try {
    console.log('Updating MiFID Transparenz- und Berichtspflichten (RTS 27/28) page with FAQs batch 1...')
    
    // First, get the existing document
    console.log('Fetching existing document...')
    const existingDoc = await client.fetch('*[_id == $id][0]', { id: 'mifid-transparenz-berichtspflichten-rts-27-28' })
    
    if (!existingDoc) {
      throw new Error('Document "mifid-transparenz-berichtspflichten-rts-27-28" not found')
    }
    
    // Create new FAQs
    const newFaqs = [
      {
        _type: 'object',
        _key: generateKey('faq', 1),
        question: "Welche konkreten Anforderungen stellen die RTS 27 und 28 an Wertpapierfirmen und Handelspl√§tze, und wie unterscheiden sich diese im Detail?",
        answer: "Die regulatorischen technischen Standards RTS 27 und 28 definieren umfassende Transparenz- und Berichtspflichten, die sich jedoch in ihrem Adressatenkreis, Inhalt und Ver√∂ffentlichungsrhythmus wesentlich unterscheiden. W√§hrend beide Standards dem √ºbergeordneten Ziel der Transparenzerh√∂hung im Finanzmarkt dienen, adressieren sie unterschiedliche Aspekte der MiFID II-Anforderungen mit spezifischen Datenerhebungs- und Berichterstattungsmechanismen.\n\nüìä RTS 27 - Anforderungen f√ºr Handelspl√§tze, systematische Internalisierer und Ausf√ºhrungspl√§tze:\n‚Ä¢ Umfassende Ausf√ºhrungsqualit√§tsberichte mit detaillierten Kennzahlen zu Preisen, Kosten, Geschwindigkeit und Wahrscheinlichkeit der Ausf√ºhrung f√ºr verschiedene Finanzinstrumentenklassen.\n‚Ä¢ Granulare Aufschl√ºsselung der Ausf√ºhrungsqualit√§t nach Instrumententyp, Ordertyp und Marktphase, einschlie√ülich detaillierter Statistiken zu Preisabweichungen und Ausf√ºhrungsunterbrechungen.\n‚Ä¢ Viertelj√§hrlicher Ver√∂ffentlichungsrhythmus mit standardisiertem Format, das maschinenlesbar und √∂ffentlich zug√§nglich sein muss.\n‚Ä¢ Spezifische Metriken f√ºr verschiedene Handelsplatztypen, einschlie√ülich detaillierter Informationen zu Markttiefe, Spread-Niveaus und Volatilit√§tsunterbrechungen.\n\nüìà RTS 28 - Anforderungen f√ºr Wertpapierfirmen:\n‚Ä¢ J√§hrliche Ver√∂ffentlichung der f√ºnf wichtigsten Ausf√ºhrungspl√§tze f√ºr jede Finanzinstrumentenklasse, basierend auf Handelsvolumen und Anzahl der ausgef√ºhrten Orders.\n‚Ä¢ Qualitative Bewertung der Ausf√ºhrungsqualit√§t mit spezifischer Analyse der f√ºnf wichtigsten Ausf√ºhrungsfaktoren: Preis, Kosten, Geschwindigkeit, Wahrscheinlichkeit der Ausf√ºhrung und weitere relevante Faktoren.\n‚Ä¢ Transparente Offenlegung m√∂glicher Interessenkonflikte und Verbindungen zu Ausf√ºhrungspl√§tzen, einschlie√ülich gemeinsamer Eigent√ºmerschaft oder spezifischer Vereinbarungen.\n‚Ä¢ Analyse der Auswirkungen von Routing-Entscheidungen auf die Ausf√ºhrungsqualit√§t und Erl√§uterung der Verwendung von Daten und Tools zur √úberwachung der Ausf√ºhrungsqualit√§t.\n\nüîÑ Wesentliche Unterschiede und komplement√§re Aspekte:\n‚Ä¢ Adressatenkreis: RTS 27 richtet sich prim√§r an Handelspl√§tze und Ausf√ºhrungspl√§tze, w√§hrend RTS 28 von Wertpapierfirmen zu erf√ºllen ist, die Kundenauftr√§ge ausf√ºhren.\n‚Ä¢ Ver√∂ffentlichungsfrequenz: RTS 27 erfordert viertelj√§hrliche Berichte, w√§hrend RTS 28 einen j√§hrlichen Berichtszyklus vorsieht.\n‚Ä¢ Datendetaillierung: RTS 27 fokussiert sich auf granulare Ausf√ºhrungsstatistiken auf Instrumentenebene, w√§hrend RTS 28 einen h√∂heren Aggregationsgrad mit qualitativen Erl√§uterungen kombiniert.\n‚Ä¢ Perspektive: RTS 27 betrachtet die Ausf√ºhrungsqualit√§t aus Sicht des Handelsplatzes, w√§hrend RTS 28 die Ausf√ºhrungspraxis der Wertpapierfirma und ihre Entscheidungsgr√ºnde transparent macht."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 2),
        question: "Wie l√§sst sich ein effizienter Datenerfassungs- und Aufbereitungsprozess f√ºr die RTS 27/28-Berichtspflichten implementieren, der sowohl regulatorische Anforderungen erf√ºllt als auch den operativen Aufwand minimiert?",
        answer: "Die Implementierung eines effizienten Datenerfassungs- und Aufbereitungsprozesses f√ºr RTS 27/28-Berichtspflichten erfordert einen strategischen Ansatz, der regulatorische Pr√§zision mit operativer Effizienz verbindet. Die Herausforderung liegt nicht nur in der Erfassung und Verarbeitung umfangreicher Datens√§tze, sondern auch in der Sicherstellung ihrer Qualit√§t, Konsistenz und zeitgerechten Verf√ºgbarkeit. Eine durchdachte Architektur bildet die Grundlage f√ºr eine nachhaltige und ressourcenschonende Compliance-L√∂sung.\n\nüîÑ Architekturprinzipien f√ºr effiziente Datenerfassung:\n‚Ä¢ Zentralisierte Datenintegration: Etablierung einer zentralen Datenintegrationsschicht, die heterogene Quellsysteme (Handelssysteme, Order Management Systeme, Marktdatenfeeds) √ºber standardisierte Schnittstellen anbindet und einen einheitlichen Datenzugriff erm√∂glicht.\n‚Ä¢ Event-basierte Datenerfassung: Implementation eines event-getriebenen Erfassungsmechanismus, der relevante Handelsereignisse in Echtzeit oder nahezu Echtzeit erfasst und in einen strukturierten Datenstrom transformiert.\n‚Ä¢ Datenaggregation in verschiedenen Zeitdimensionen: Entwicklung eines mehrstufigen Aggregationssystems, das Rohdaten auf verschiedenen Zeitebenen (Intraday, End-of-Day, End-of-Quarter) verdichtet und so sowohl operative √úberwachung als auch regulatorisches Reporting unterst√ºtzt.\n‚Ä¢ Datenhistorisierung mit Point-in-Time-Recovery: Implementierung eines Historisierungskonzepts, das nicht nur aktuelle Daten speichert, sondern auch die zeitpunktbezogene Rekonstruktion historischer Zust√§nde erm√∂glicht.\n\nüõ†Ô∏è Technologische Bausteine f√ºr optimierte Datenaufbereitung:\n‚Ä¢ Automatisierte Datenqualit√§tssicherung: Einrichtung automatisierter Validierungsroutinen, die Daten kontinuierlich auf Vollst√§ndigkeit, Konsistenz und Plausibilit√§t pr√ºfen und Anomalien fr√ºhzeitig identifizieren und eskalieren.\n‚Ä¢ Regelbasierte Transformationsengine: Entwicklung einer flexiblen Transformationslogik, die rohe Handelsdaten gem√§√ü den spezifischen Anforderungen von RTS 27/28 aufbereitet und dabei regulatorische √Ñnderungen durch konfigurierbare Regeln abbilden kann.\n‚Ä¢ Exception-Management-Workflow: Implementation eines strukturierten Prozesses f√ºr die Behandlung von Datenausnahmen, der manuelle Eingriffe minimiert und gleichzeitig eine nachvollziehbare Dokumentation aller Korrekturen sicherstellt.\n‚Ä¢ Versionierte Berechnungsmodelle: Etablierung eines Versionsmanagements f√ºr Berechnungslogiken, das √Ñnderungen transparent nachvollziehbar macht und bei Bedarf die Neugenerierung historischer Berichte mit aktualisierten Methoden erm√∂glicht.\n\nüìà Operationalisierung und Effizienzoptimierung:\n‚Ä¢ Prozessautomatisierung durch Workflow-Engine: Implementierung einer Workflow-L√∂sung, die den gesamten Berichtsprozess von der Datenerfassung bis zur Ver√∂ffentlichung orchestriert und automatisierte Qualit√§tschecks und Freigabemechanismen integriert.\n‚Ä¢ Inkrementelle Verarbeitung: Optimierung der Datenverarbeitung durch inkrementelle Ans√§tze, die nur √Ñnderungen und neue Daten prozessieren und so Rechenressourcen schonen.\n‚Ä¢ Parallelisierte Berechnung: Nutzung moderner Parallelverarbeitungstechnologien f√ºr rechenintensive Aggregationen und statistische Analysen, um Verarbeitungszeiten zu minimieren.\n‚Ä¢ Self-Service-Validierungstools: Bereitstellung intuitiver Validierungstools f√ºr Fachbereiche, die eine eigenst√§ndige √úberpr√ºfung der generierten Berichte erm√∂glichen und den Abstimmungsaufwand zwischen IT und Fachabteilungen reduzieren."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 3),
        question: "Welche technischen und methodischen Herausforderungen ergeben sich bei der Implementierung der Best-Execution-√úberwachung gem√§√ü RTS 28, und wie k√∂nnen diese effektiv adressiert werden?",
        answer: "Die Implementierung einer effektiven Best-Execution-√úberwachung gem√§√ü RTS 28 stellt Wertpapierfirmen vor komplexe technische und methodische Herausforderungen. Diese reichen von der Etablierung geeigneter Datenstrukturen √ºber die Definition relevanter Metriken bis zur Entwicklung aussagekr√§ftiger Analysemodelle. Eine systematische Herangehensweise, die sowohl technologische als auch fachliche Aspekte ber√ºcksichtigt, ist entscheidend f√ºr eine erfolgreiche Umsetzung, die nicht nur regulatorische Anforderungen erf√ºllt, sondern auch operativen Mehrwert schafft.\n\nüîç Zentrale Herausforderungen der Best-Execution-√úberwachung:\n‚Ä¢ Multidimensionale Datenerfassung: Die umfassende Bewertung der Ausf√ºhrungsqualit√§t erfordert die Integration heterogener Datenpunkte aus verschiedenen Quellsystemen, einschlie√ülich Orderdetails, Marktdaten, Referenzdaten und Ausf√ºhrungsinformationen.\n‚Ä¢ Instrumentenspezifische Komplexit√§t: Unterschiedliche Finanzinstrumentenklassen erfordern spezifische Bewertungsans√§tze und Metriken, die den jeweiligen Marktmechanismen und Liquidit√§tsprofilen Rechnung tragen.\n‚Ä¢ Benchmark-Definition: Die Festlegung objektiver und repr√§sentativer Vergleichsma√üst√§be f√ºr verschiedene Ausf√ºhrungsfaktoren (Preis, Kosten, Geschwindigkeit) stellt eine methodische Herausforderung dar, insbesondere bei illiquiden oder komplexen Instrumenten.\n‚Ä¢ Interdependenzanalyse: Die simultane Ber√ºcksichtigung multipler Ausf√ºhrungsfaktoren und deren Wechselwirkungen erfordert sophistizierte Analysemethoden, die eine ausgewogene Gesamtbewertung erm√∂glichen.\n\nüí° Methodische L√∂sungsans√§tze f√ºr eine effektive Implementierung:\n‚Ä¢ Hierarchisches Datenmodell: Entwicklung eines strukturierten Datenmodells, das alle relevanten Ausf√ºhrungsfaktoren in einer hierarchischen Struktur organisiert und sowohl instrumentenspezifische Besonderheiten als auch √ºbergreifende Bewertungskategorien abbildet.\n‚Ä¢ Multifaktorielle Scoring-Methodik: Implementation eines gewichteten Scoring-Ansatzes, der multiple Ausf√ºhrungsfaktoren entsprechend ihrer Relevanz f√ºr verschiedene Kundensegmente und Instrumententypen bewertet und zu einem aussagekr√§ftigen Gesamtbild aggregiert.\n‚Ä¢ Adaptive Benchmarking-Strategie: Etablierung eines flexiblen Benchmarking-Konzepts, das je nach Instrument und Marktbedingungen unterschiedliche Referenzpunkte heranzieht (z.B. VWAP, TWAP, konkurrierende Venues) und diese dynamisch an Marktver√§nderungen anpasst.\n‚Ä¢ Szenarien-basierte Qualit√§tsbewertung: Entwicklung typischer Ausf√ºhrungsszenarien f√ºr verschiedene Instrumentenklassen und Marktbedingungen, die als strukturierte Bewertungsgrundlage dienen und einen konsistenten Vergleichsrahmen schaffen.\n\nüõ†Ô∏è Technische Implementierungsstrategien:\n‚Ä¢ Echtzeit-Monitoring-Plattform: Aufbau einer Echtzeit-√úberwachungsinfrastruktur, die kritische Ausf√ºhrungsparameter kontinuierlich erfasst und analysiert, um proaktive Optimierungen zu erm√∂glichen und nicht erst reaktiv auf Quartals- oder Jahresberichte zu reagieren.\n‚Ä¢ Rule Engine f√ºr Ausf√ºhrungsklassifikation: Implementation einer regelbasierten Engine, die Ausf√ºhrungen automatisch klassifiziert und bewertet, basierend auf konfigurierbaren Schwellenwerten und Bewertungskriterien, die regulatorische √Ñnderungen flexibel abbilden k√∂nnen.\n‚Ä¢ Visuelle Analytik-Dashboards: Entwicklung intuitiver Visualisierungstools, die komplexe Ausf√ºhrungsdaten in verst√§ndliche Insights transformieren und Entscheidungstr√§gern erm√∂glichen, Optimierungspotenziale schnell zu identifizieren.\n‚Ä¢ Machine-Learning-gest√ºtzte Anomalieerkennung: Einsatz von KI-Algorithmen zur Identifikation ungew√∂hnlicher Ausf√ºhrungsmuster oder systematischer Abweichungen, die auf Optimierungspotenziale oder Compliance-Risiken hindeuten k√∂nnen."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 4),
        question: "Wie k√∂nnen Finanzinstitute die RTS 27/28-Compliance-Implementierung nutzen, um √ºber die reine Regulatorik hinaus strategischen Mehrwert und Wettbewerbsvorteile zu generieren?",
        answer: "Die Implementierung der MiFID-Transparenzanforderungen nach RTS 27/28 bietet Finanzinstituten weit mehr als nur die Erf√ºllung regulatorischer Pflichten. Zukunftsorientierte Institute erkennen in diesen Anforderungen eine strategische Chance zur Transformation von Gesch√§ftsprozessen, Dateninfrastrukturen und Kundenbeziehungen. Mit einem wertzentrierten Implementierungsansatz k√∂nnen signifikante Wettbewerbsvorteile erzielt und neue Gesch√§ftspotenziale erschlossen werden.\n\nüöÄ Strategische Transformationspotenziale:\n‚Ä¢ Datengetriebene Gesch√§ftsoptimierung: Nutzung der f√ºr RTS 27/28 erfassten umfangreichen Ausf√ºhrungs- und Qualit√§tsdaten als Grundlage f√ºr datenbasierte Gesch√§ftsentscheidungen und kontinuierliche Prozessoptimierung im Handelsbereich.\n‚Ä¢ Aufbau einer zukunftsf√§higen Datenarchitektur: Entwicklung einer skalierbaren, integrierten Dateninfrastruktur, die nicht nur regulatorische Anforderungen erf√ºllt, sondern auch als Fundament f√ºr weitergehende Analytics-Anwendungen und zuk√ºnftige Gesch√§ftsinitiativen dient.\n‚Ä¢ Differenzierung durch Transparenz: Transformation der regulatorisch geforderten Transparenz in ein Differenzierungsmerkmal, das Vertrauen schafft und als Grundlage f√ºr eine verbesserte Kundenberatung und -bindung dient.\n‚Ä¢ Katalysator f√ºr digitale Transformation: Nutzung der RTS-Implementierung als Anlass f√ºr eine umfassendere Digitalisierung und Automatisierung von Handelsprozessen und Reporting-Funktionen.\n\nüíº Konkrete Mehrwertdimensionen und Implementierungsstrategien:\n‚Ä¢ Best-Execution-Excellence: Entwicklung einer Best-Execution-Praxis, die weit √ºber die regulatorischen Mindestanforderungen hinausgeht und einen messbaren Mehrwert f√ºr Kunden schafft, durch systematische Analyse und kontinuierliche Optimierung aller Ausf√ºhrungsfaktoren.\n‚Ä¢ Customer Experience Enhancement: Integration der Transparenzdaten in kundenorientierte Beratungs- und Reporting-Tools, die Kunden tiefere Einblicke in die Qualit√§t der Auftragsausf√ºhrung bieten und so Vertrauen und Kundenzufriedenheit steigern.\n‚Ä¢ Kostenoptimierung im Handelsprozess: Nutzung der detaillierten Ausf√ºhrungsdaten zur systematischen Identifikation von Kostenoptimierungspotenzialen in der Order-Routing-Strategie und bei der Auswahl von Handelspl√§tzen.\n‚Ä¢ Compliance als Service: Entwicklung innovativer Service-Angebote f√ºr institutionelle Kunden, die bei der Erf√ºllung ihrer eigenen regulatorischen Anforderungen unterst√ºtzen und so zus√§tzliche Ertragsquellen erschlie√üen.\n\nüìä Datenmonetarisierung und analytischer Mehrwert:\n‚Ä¢ Handelsperformance-Analytik: Entwicklung sophistizierter Analysewerkzeuge, die √ºber die regulatorischen Berichte hinaus tiefgreifende Einblicke in Handelsstrategien und deren Erfolgsfaktoren erm√∂glichen.\n‚Ä¢ Competitive Intelligence: Systematische Auswertung der √∂ffentlich verf√ºgbaren RTS-Berichte von Wettbewerbern zur Identifikation von Markttrends, Benchmark-Vergleichen und strategischen Positionierungsm√∂glichkeiten.\n‚Ä¢ Predictive Trading Analytics: Nutzung historischer Ausf√ºhrungsdaten zur Entwicklung pr√§diktiver Modelle, die optimale Handelszeitpunkte, Venues und Strategien f√ºr verschiedene Marktbedingungen und Instrumentenklassen vorhersagen.\n‚Ä¢ Risk-adjusted Execution Optimization: Integration von Risikometriken in die Ausf√ºhrungsanalyse zur Entwicklung risikoadjustierter Optimierungsstrategien, die sowohl Performance als auch Risikominimierung ber√ºcksichtigen."
      }
    ]
    
    // Update the document with new FAQs
    const updatedFaqs = [...(existingDoc.faq || []), ...newFaqs]
    
    console.log(`Adding ${newFaqs.length} new FAQs to the document...`)
    const transaction = client.transaction()
    transaction.patch(existingDoc._id, {
      set: {
        faq: updatedFaqs
      }
    })
    
    await transaction.commit()
    console.log('‚úÖ FAQs batch 1 added successfully')
  } catch (error) {
    console.error('Error:', error)
    throw error
  }
}

run()
