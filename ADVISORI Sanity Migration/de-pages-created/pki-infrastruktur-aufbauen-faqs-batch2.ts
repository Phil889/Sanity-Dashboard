import 'dotenv/config'
import { createClient } from '@sanity/client'

// Create client with direct credentials
const client = createClient({
  projectId: 'wwmm9rbb',
  dataset: 'production',
  apiVersion: '2024-02-14',
  token: process.env.SANITY_API_TOKEN,
  useCdn: false,
})

// Helper function to generate unique keys
function generateKey(prefix: string, index: number): string {
  return `${prefix}_${Date.now()}_${index}`
}

const run = async () => {
  try {
    console.log('Updating PKI Infrastruktur aufbauen page with FAQ batch 2...')
    
    // First, get the existing document
    console.log('Fetching existing document...')
    const existingDoc = await client.fetch('*[_id == $id][0]', { id: 'pki-infrastruktur-aufbauen' })
    
    if (!existingDoc) {
      throw new Error('Document "pki-infrastruktur-aufbauen" not found')
    }
    
    // Create new FAQs for implementation strategy and security
    const newFaqs = [
      {
        _type: 'object',
        _key: generateKey('faq', 5),
        question: 'Welche Implementierungsstrategien haben sich beim PKI-Infrastruktur-Aufbau bew√§hrt?',
        answer: "Eine erfolgreiche PKI-Implementierung erfordert eine durchdachte Strategie, die technische Komplexit√§t mit organisatorischen Anforderungen in Einklang bringt. Bew√§hrte Implementierungsans√§tze kombinieren phasenweise Rollouts mit kontinuierlicher Validierung und erm√∂glichen es Organisationen, Risiken zu minimieren und gleichzeitig schnell Wert zu schaffen.\n\nüéØ Phasenweise Implementierungsstrategie:\n‚Ä¢ Proof-of-Concept-Phase mit begrenztem Scope zur Validierung der grundlegenden PKI-Funktionalit√§ten und Architekturentscheidungen\n‚Ä¢ Pilotphase mit ausgew√§hlten Anwendungsf√§llen und Benutzergruppen zur Sammlung praktischer Erfahrungen\n‚Ä¢ Schrittweise Erweiterung auf weitere Anwendungsbereiche mit kontinuierlicher Optimierung basierend auf Lessons Learned\n‚Ä¢ Vollst√§ndiger Rollout mit etablierten Prozessen und bew√§hrten Konfigurationen\n‚Ä¢ Post-Implementation-Optimierung mit Performance-Tuning und Feature-Erweiterungen\n\nüèóÔ∏è Architektur-First-Ansatz:\n‚Ä¢ Entwicklung einer robusten PKI-Architektur vor Beginn der technischen Implementierung\n‚Ä¢ Definition klarer Schnittstellen und Integrationspunkte f√ºr alle PKI-Komponenten\n‚Ä¢ Etablierung von Standards und Richtlinien f√ºr konsistente PKI-Nutzung\n‚Ä¢ Implementierung von Monitoring und Management-Capabilities von Anfang an\n‚Ä¢ Ber√ºcksichtigung von Skalierbarkeits- und Performance-Anforderungen in der Grundarchitektur\n\nüîÑ Iterative Entwicklung und Continuous Integration:\n‚Ä¢ Anwendung agiler Entwicklungsmethoden f√ºr flexible Anpassung an sich √§ndernde Anforderungen\n‚Ä¢ Implementierung von DevOps-Praktiken f√ºr automatisierte Deployment- und Testing-Prozesse\n‚Ä¢ Kontinuierliche Integration von Feedback aus Pilotphasen und Produktivbetrieb\n‚Ä¢ Regelm√§√üige Architektur-Reviews und Technology-Updates\n‚Ä¢ Etablierung von Change Management-Prozessen f√ºr kontrollierte Weiterentwicklung\n\nüõ°Ô∏è Security-by-Design-Integration:\n‚Ä¢ Implementierung von Sicherheitskontrollen als integraler Bestandteil der PKI-Architektur\n‚Ä¢ Durchf√ºhrung regelm√§√üiger Security Assessments w√§hrend aller Implementierungsphasen\n‚Ä¢ Integration von Threat Modeling und Risk Assessment in den Entwicklungsprozess\n‚Ä¢ Implementierung umfassender Logging und Monitoring f√ºr Security Operations\n‚Ä¢ Etablierung von Incident Response-Verfahren parallel zur PKI-Implementierung\n\nü§ù Stakeholder-Integration und Change Management:\n‚Ä¢ Fr√ºhzeitige Einbindung aller relevanten Stakeholder in Planungs- und Implementierungsprozesse\n‚Ä¢ Entwicklung umfassender Kommunikationsstrategien f√ºr verschiedene Zielgruppen\n‚Ä¢ Implementierung strukturierter Schulungsprogramme f√ºr Administratoren und Endbenutzer\n‚Ä¢ Etablierung von Support-Strukturen und Helpdesk-Funktionen\n‚Ä¢ Kontinuierliche Sammlung und Integration von Benutzer-Feedback\n\nüìä Metriken-basierte Implementierung:\n‚Ä¢ Definition klarer KPIs und Erfolgskriterien f√ºr jede Implementierungsphase\n‚Ä¢ Implementierung von Monitoring-Dashboards f√ºr kontinuierliche Performance-√úberwachung\n‚Ä¢ Regelm√§√üige Bewertung des Implementierungsfortschritts gegen definierte Meilensteine\n‚Ä¢ Anpassung der Implementierungsstrategie basierend auf gemessenen Ergebnissen\n‚Ä¢ Dokumentation von Lessons Learned f√ºr zuk√ºnftige PKI-Projekte"
      },
      {
        _type: 'object',
        _key: generateKey('faq', 6),
        question: 'Wie gew√§hrleistet man die sichere Implementierung kritischer PKI-Komponenten?',
        answer: "Die sichere Implementierung kritischer PKI-Komponenten erfordert einen systematischen Ansatz, der bew√§hrte Sicherheitspraktiken mit spezifischen PKI-Anforderungen kombiniert. Jede Komponente der PKI-Infrastruktur stellt einzigartige Sicherheitsherausforderungen dar und muss entsprechend ihrer Kritikalit√§t und ihres Risikoprofils gesch√ºtzt werden.\n\nüîê Root Certificate Authority-Sicherheit:\n‚Ä¢ Implementierung von Air-Gap-Systemen f√ºr Root CA mit vollst√§ndiger Netzwerkisolierung\n‚Ä¢ Verwendung von Hardware Security Modules mit FIPS oder Common Criteria-Zertifizierung f√ºr Schl√ºsselspeicherung\n‚Ä¢ Etablierung strenger physischer Sicherheitsma√ünahmen einschlie√ülich Zugangskontrollen und √úberwachung\n‚Ä¢ Implementierung von Multi-Person-Kontrollen f√ºr alle kritischen Root CA-Operationen\n‚Ä¢ Entwicklung umfassender Backup- und Disaster Recovery-Verfahren mit sicherer Offline-Speicherung\n\nüè¢ Intermediate CA und Issuing CA-H√§rtung:\n‚Ä¢ Implementierung von Defense-in-Depth-Strategien mit mehrschichtigen Sicherheitskontrollen\n‚Ä¢ Verwendung dedizierter, geh√§rteter Server-Systeme mit minimaler Angriffsfl√§che\n‚Ä¢ Implementierung von Network Segmentation und Firewall-Regeln f√ºr CA-Systeme\n‚Ä¢ Etablierung von Role-Based Access Control mit Principle of Least Privilege\n‚Ä¢ Kontinuierliche Vulnerability Management und Security Patching-Prozesse\n\nüîë Schl√ºsselverwaltung und Kryptographie:\n‚Ä¢ Implementierung sicherer Schl√ºsselgenerierung mit zertifizierten Zufallszahlengeneratoren\n‚Ä¢ Verwendung angemessener Schl√ºssell√§ngen und kryptographischer Algorithmen entsprechend aktueller Standards\n‚Ä¢ Etablierung sicherer Schl√ºsselverteilung und -speicherung mit Hardware-basierten L√∂sungen\n‚Ä¢ Implementierung von Key Escrow-Verfahren f√ºr kritische Gesch√§ftsanwendungen\n‚Ä¢ Planung f√ºr Crypto-Agility und zuk√ºnftige Algorithmus-Migrationen\n\nüìã Certificate Policy und Practice Statement:\n‚Ä¢ Entwicklung umfassender Certificate Policies entsprechend organisatorischen Anforderungen\n‚Ä¢ Implementierung detaillierter Certificate Practice Statements mit operativen Verfahren\n‚Ä¢ Etablierung von Audit-Verfahren zur Validierung der Policy-Compliance\n‚Ä¢ Integration regulatorischer Anforderungen in Certificate Policies\n‚Ä¢ Regelm√§√üige Review und Update von Policies basierend auf sich √§ndernden Anforderungen\n\nüõ°Ô∏è Operational Security und Monitoring:\n‚Ä¢ Implementierung umfassender Logging f√ºr alle PKI-Operationen mit Tamper-Evident-Mechanismen\n‚Ä¢ Etablierung von Security Information and Event Management f√ºr PKI-spezifische Events\n‚Ä¢ Entwicklung von Anomalie-Erkennungssystemen f√ºr ungew√∂hnliche Certificate-Aktivit√§ten\n‚Ä¢ Implementierung von Real-time Alerting f√ºr kritische Sicherheitsereignisse\n‚Ä¢ Regelm√§√üige Security Assessments und Penetrationstests f√ºr alle PKI-Komponenten\n\nüîÑ Incident Response und Business Continuity:\n‚Ä¢ Entwicklung PKI-spezifischer Incident Response-Verfahren f√ºr verschiedene Bedrohungsszenarien\n‚Ä¢ Etablierung von Certificate Revocation-Prozessen f√ºr Kompromittierungsszenarien\n‚Ä¢ Implementierung von Backup CA-Systemen f√ºr kritische Business Continuity\n‚Ä¢ Entwicklung von Disaster Recovery-Pl√§nen mit definierten Recovery Time Objectives\n‚Ä¢ Regelm√§√üige Durchf√ºhrung von Disaster Recovery-Tests und Tabletop-√úbungen"
      },
      {
        _type: 'object',
        _key: generateKey('faq', 7),
        question: 'Welche Technologie-Entscheidungen sind beim PKI-Aufbau besonders kritisch?',
        answer: "Technologie-Entscheidungen beim PKI-Aufbau haben langfristige Auswirkungen auf Sicherheit, Performance, Skalierbarkeit und operative Effizienz. Diese Entscheidungen m√ºssen sorgf√§ltig evaluiert werden, da sie die Grundlage f√ºr Jahre oder sogar Jahrzehnte des PKI-Betriebs bilden und nachtr√§gliche √Ñnderungen oft komplex und kostspielig sind.\n\nüèóÔ∏è PKI-Plattform und Vendor-Auswahl:\n‚Ä¢ Evaluierung verschiedener PKI-Plattformen basierend auf Funktionalit√§t, Skalierbarkeit und Herstellerunterst√ºtzung\n‚Ä¢ Bewertung von Open Source vs. Commercial Solutions hinsichtlich Total Cost of Ownership und Support-Anforderungen\n‚Ä¢ Analyse der Vendor-Roadmap und langfristigen Produktstrategie f√ºr Zukunftssicherheit\n‚Ä¢ Ber√ºcksichtigung von Interoperabilit√§ts-Standards und Multi-Vendor-Umgebungen\n‚Ä¢ Bewertung von Lizenzmodellen und deren Auswirkungen auf Skalierung und Budget\n\nüîê Kryptographische Algorithmen und Standards:\n‚Ä¢ Auswahl geeigneter Hash-Algorithmen, Signaturverfahren und Schl√ºssell√§ngen basierend auf Sicherheitsanforderungen\n‚Ä¢ Ber√ºcksichtigung aktueller NIST, BSI und ENISA-Empfehlungen f√ºr kryptographische Standards\n‚Ä¢ Planung f√ºr Post-Quantum-Cryptography und zuk√ºnftige Algorithmus-Migrationen\n‚Ä¢ Implementierung von Crypto-Agility f√ºr flexible Anpassung an neue Standards\n‚Ä¢ Bewertung von Performance-Auswirkungen verschiedener kryptographischer Optionen\n\nüñ•Ô∏è Deployment-Architektur und Infrastructure:\n‚Ä¢ Entscheidung zwischen Cloud-, Hybrid- und On-Premises-Deployment-Modellen\n‚Ä¢ Evaluierung verschiedener Virtualisierungs- und Container-Technologien f√ºr PKI-Services\n‚Ä¢ Planung von High Availability und Load Balancing-Strategien f√ºr kritische Komponenten\n‚Ä¢ Ber√ºcksichtigung von Disaster Recovery und Geographic Distribution-Anforderungen\n‚Ä¢ Integration mit bestehenden IT-Infrastructure und Management-Systemen\n\nüîß Hardware Security Module-Integration:\n‚Ä¢ Auswahl zwischen Network-attached, PCIe-basierten und USB-Token HSM-L√∂sungen\n‚Ä¢ Bewertung von FIPS und Common Criteria-Zertifizierungen f√ºr Compliance-Anforderungen\n‚Ä¢ Planung von HSM-Clustering und Backup-Strategien f√ºr High Availability\n‚Ä¢ Integration von HSM-Management in operative PKI-Prozesse\n‚Ä¢ Ber√ºcksichtigung von Performance und Skalierbarkeits-Limitationen verschiedener HSM-Typen\n\nüåê Integration und API-Strategien:\n‚Ä¢ Design von RESTful APIs f√ºr moderne Application-Integration\n‚Ä¢ Implementierung von SCEP, EST und anderen Standard-Protokollen f√ºr Device Enrollment\n‚Ä¢ Integration mit Identity und Access Management-Systemen √ºber LDAP, SAML oder OAuth\n‚Ä¢ Entwicklung von SDK und Libraries f√ºr Developer-friendly PKI-Integration\n‚Ä¢ Ber√ºcksichtigung von Microservices-Architekturen und Container-basierter Deployment\n\nüìä Monitoring und Management-Tools:\n‚Ä¢ Auswahl geeigneter Certificate Lifecycle Management-Tools f√ºr operative Effizienz\n‚Ä¢ Integration mit Enterprise Monitoring-Systemen wie SIEM und Network Management\n‚Ä¢ Implementierung von Certificate Discovery und Inventory-Management-L√∂sungen\n‚Ä¢ Entwicklung von Custom Dashboards und Reporting-Capabilities\n‚Ä¢ Ber√ºcksichtigung von Automation und Orchestration-Tools f√ºr operative Skalierung\n\nüîÑ Backup und Disaster Recovery-Technologien:\n‚Ä¢ Implementierung sicherer Backup-L√∂sungen mit Encryption und Access Controls\n‚Ä¢ Planung von Geographic Replication f√ºr kritische PKI-Daten\n‚Ä¢ Ber√ºcksichtigung von Recovery Point Objectives und Recovery Time Objectives\n‚Ä¢ Integration mit Enterprise Backup und Disaster Recovery-Infrastrukturen\n‚Ä¢ Entwicklung von Automated Recovery-Prozessen f√ºr minimale Downtime"
      },
      {
        _type: 'object',
        _key: generateKey('faq', 8),
        question: 'Wie plant man die Integration einer neuen PKI in bestehende IT-Landschaften?',
        answer: "Die Integration einer neuen PKI in bestehende IT-Landschaften ist eine der komplexesten Aspekte des PKI-Aufbaus und erfordert sorgf√§ltige Planung, um Betriebsunterbrechungen zu minimieren und maximale Kompatibilit√§t zu gew√§hrleisten. Eine erfolgreiche Integration muss sowohl technische als auch organisatorische Aspekte ber√ºcksichtigen.\n\nüîç Bestandsaufnahme und Dependency Mapping:\n‚Ä¢ Durchf√ºhrung einer umfassenden Inventarisierung aller bestehenden Systeme, Anwendungen und Sicherheitskomponenten\n‚Ä¢ Identifikation existierender Certificate-Nutzung und Legacy PKI-Implementierungen\n‚Ä¢ Mapping von Abh√§ngigkeiten zwischen verschiedenen IT-Systemen und deren Certificate-Anforderungen\n‚Ä¢ Analyse bestehender Identity und Access Management-Infrastrukturen\n‚Ä¢ Bewertung aktueller Netzwerk-Architekturen und Sicherheits-Policies\n\nüîó API und Protocol-Integration:\n‚Ä¢ Design standardbasierter Schnittstellen f√ºr nahtlose Application-Integration\n‚Ä¢ Implementierung von LDAP-Integration f√ºr Directory Services und User Management\n‚Ä¢ Ber√ºcksichtigung bestehender Web Services und deren Certificate-Anforderungen\n‚Ä¢ Integration mit Enterprise Service Bus und Middleware-Komponenten\n‚Ä¢ Entwicklung von Adapter-L√∂sungen f√ºr Legacy-Systeme ohne native PKI-Unterst√ºtzung\n\nüè¢ Directory Services und Identity Management:\n‚Ä¢ Integration mit Active Directory, LDAP und anderen Directory Services\n‚Ä¢ Synchronisation von User-Identit√§ten zwischen PKI und bestehenden Identity Stores\n‚Ä¢ Implementierung von Single Sign-On-Integration √ºber SAML oder OAuth\n‚Ä¢ Ber√ºcksichtigung von Federated Identity-Szenarien mit externen Partnern\n‚Ä¢ Entwicklung von User Provisioning und Deprovisioning-Workflows\n\nüåê Netzwerk und Infrastruktur-Integration:\n‚Ä¢ Planung von Network Segmentation und Firewall-Regeln f√ºr PKI-Services\n‚Ä¢ Integration mit bestehenden Load Balancers und High Availability-Infrastrukturen\n‚Ä¢ Ber√ºcksichtigung von VPN und Remote Access-Anforderungen\n‚Ä¢ Implementation von Certificate-based Network Access Control\n‚Ä¢ Integration mit Network Monitoring und Management-Systemen\n\nüì± Application und Service-Integration:\n‚Ä¢ Entwicklung von Certificate Enrollment-Prozessen f√ºr verschiedene Application-Typen\n‚Ä¢ Integration mit Web Servers, Application Servers und Database-Systemen\n‚Ä¢ Ber√ºcksichtigung von Mobile Device Management und BYOD-Szenarien\n‚Ä¢ Implementation von Code Signing-Workflows f√ºr Software Development\n‚Ä¢ Integration mit Cloud Services und SaaS-Anwendungen\n\nüîÑ Migration und Transition-Strategien:\n‚Ä¢ Entwicklung phasenweiser Migration-Pl√§ne f√ºr bestehende Certificate-Infrastrukturen\n‚Ä¢ Planung von Parallel-Betrieb w√§hrend Transition-Phasen\n‚Ä¢ Implementation von Certificate Bridging f√ºr Interoperabilit√§t\n‚Ä¢ Ber√ºcksichtigung von Rollback-Szenarien bei Migration-Problemen\n‚Ä¢ Entwicklung von Testing-Strategien f√ºr alle Integration-Punkte\n\nüìä Monitoring und Operations-Integration:\n‚Ä¢ Integration mit bestehenden SIEM und Security Operations Center-Infrastrukturen\n‚Ä¢ Implementation von Certificate Lifecycle-Monitoring in Enterprise Management-Systemen\n‚Ä¢ Entwicklung von Alerting und Notification-Workflows\n‚Ä¢ Integration mit Change Management und ITIL-Prozessen\n‚Ä¢ Ber√ºcksichtigung von Compliance Reporting und Audit-Anforderungen\n\nüõ°Ô∏è Security und Compliance-Integration:\n‚Ä¢ Alignment mit bestehenden Security Policies und Governance-Frameworks\n‚Ä¢ Integration mit Vulnerability Management und Security Assessment-Prozessen\n‚Ä¢ Ber√ºcksichtigung von Data Loss Prevention und Information Rights Management\n‚Ä¢ Implementation von Audit Logging entsprechend bestehender Compliance-Anforderungen\n‚Ä¢ Integration mit Risk Management und Business Continuity-Planungen"
      }
    ]
    
    // Update the document with new FAQs
    const updatedFaqs = [...(existingDoc.faq || []), ...newFaqs]
    
    console.log(`Adding ${newFaqs.length} new FAQs to the document...`)
    const transaction = client.transaction()
    transaction.patch(existingDoc._id, {
      set: {
        faq: updatedFaqs
      }
    })
    
    await transaction.commit()
    console.log('‚úÖ FAQ batch 2 added successfully')
  } catch (error) {
    console.error('Error:', error)
    throw error
  }
}

run()
