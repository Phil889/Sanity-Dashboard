import 'dotenv/config'
import { createClient } from '@sanity/client'

// Create client with direct credentials
const client = createClient({
  projectId: 'wwmm9rbb',
  dataset: 'production',
  apiVersion: '2024-02-14',
  token: process.env.SANITY_API_TOKEN,
  useCdn: false,
})

// Helper function to generate unique keys
function generateKey(prefix: string, index: number): string {
  return `${prefix}_${Date.now()}_${index}`
}

const run = async () => {
  try {
    console.log('Updating CRR/CRD RWA Berechnung Methodik page with FAQs batch 3...')
    
    // First, get the existing document
    console.log('Fetching existing document...')
    const existingDoc = await client.fetch('*[_id == $id][0]', { id: 'crr-crd-rwa-berechnung-methodik' })
    
    if (!existingDoc) {
      throw new Error('Document "crr-crd-rwa-berechnung-methodik" not found')
    }
    
    // Create new FAQs
    const newFaqs = [
      {
        _type: 'object',
        _key: generateKey('faq', 1),
        question: "Wie sollten Finanzinstitute ihre RWA-Berechnungsmethodik f√ºr operationelle Risiken und die Integration in das allgemeine Risikomanagement gestalten?",
        answer: "Die Berechnung der risikogewichteten Aktiva (RWA) f√ºr operationelle Risiken stellt viele Finanzinstitute vor besondere Herausforderungen, da die Quantifizierung operationeller Risiken komplexer ist als bei anderen Risikokategorien. Die Integration dieser Berechnungen in das √ºbergreifende Risikomanagement erfordert einen strukturierten, aber dennoch flexiblen Ansatz, der methodische Pr√§zision mit praktischer Nutzbarkeit verbindet.\n\nüîÑ Methodische Ans√§tze f√ºr operationelle Risiko-RWA:\n‚Ä¢ Standardized Measurement Approach (SMA): Der neue SMA nach Basel IV/finalem Basel III kombiniert einen bilanzkennzahlenbasierten Business Indicator (BI) mit einem internen Verlustdatenmultiplikator (ILM). Die Herausforderung liegt in der sorgf√§ltigen Kalibrierung des BI und der systematischen Erfassung historischer Verlustdaten f√ºr den ILM.\n‚Ä¢ Erweiterte Verlustdatenanalyse: Implementierung fortschrittlicher statistischer Verfahren zur Analyse interner und externer Verlustdaten, inklusive Quantifizierung der Abh√§ngigkeiten zwischen verschiedenen Risikoereignissen und Ber√ºcksichtigung extremer Tail-Risiken, die in historischen Daten selten auftreten.\n‚Ä¢ Szenarioanalysen und Stresstests: Erg√§nzung statistischer Modelle durch fundierte Experteneinsch√§tzungen und Szenarioanalysen, um Extremrisiken abzudecken, f√ºr die nur begrenzte Daten verf√ºgbar sind, insbesondere f√ºr neue und emerging operational risks wie Cyber- und Drittparteienrisiken.\n‚Ä¢ Key Risk Indicators (KRIs): Etablierung von Fr√ºhwarnindikatoren, die als Inputfaktoren f√ºr die RWA-Berechnung dienen k√∂nnen und eine dynamische Anpassung der Kapitalanforderungen an ver√§nderte Risikolandschaften erm√∂glichen.\n\nüîó Integration in das gesamthafte Risikomanagement:\n‚Ä¢ Drei-S√§ulen-Ansatz: Verkn√ºpfung der S√§ule 1 (regulatorische RWA-Berechnung) mit S√§ule 2 (ICAAP, √∂konomische Kapitalmodellierung) und S√§ule 3 (Offenlegung), um ein konsistentes Gesamtbild des operationellen Risikoprofils zu gew√§hrleisten und Redundanzen zu vermeiden.\n‚Ä¢ Use Test: Sicherstellung, dass die RWA-Berechnung nicht nur f√ºr regulatorische Zwecke durchgef√ºhrt wird, sondern auch aktiv f√ºr interne Steuerungsentscheidungen genutzt wird, etwa f√ºr Risiko-Appetit-Definitionen, Limitfestlegung oder Ressourcenallokation auf Gesch√§ftsbereiche.\n‚Ä¢ Governance-Integration: Etablierung klarer Verantwortlichkeiten f√ºr die RWA-Berechnung innerhalb des Three-Lines-of-Defense-Modells, mit besonderem Fokus auf die √ºbergreifende Steuerung operationeller Risiken durch spezifische Gremien und Prozesse.\n‚Ä¢ Management Reporting: Entwicklung eines integrierten Berichtswesens, das regulatorische RWA-Kennzahlen mit internen Risikometriken verbindet und Management-Entscheidungen auf Basis einer ganzheitlichen Sicht erm√∂glicht.\n\nüìå Praktische Implementierungsaspekte:\n‚Ä¢ Data Pooling: Teilnahme an Industrieinitiativen zum Austausch von Verlustdaten (z.B. ORX), um die Datenbasis f√ºr die Quantifizierung seltener, aber schwerwiegender operationeller Risiken zu erweitern und die Modellkalibrierung zu verbessern.\n‚Ä¢ Integrierte Risikoregister: Verkn√ºpfung qualitativer Risikobewertungen aus dem operativen Risikomanagement mit quantitativen RWA-Berechnungen, um einen einheitlichen Risikobewertungsrahmen zu schaffen.\n‚Ä¢ Technologische Infrastruktur: Implementierung spezialisierter GRC-Plattformen (Governance, Risk, Compliance), die sowohl die regulatorische RWA-Berechnung als auch das operative Risikomanagement unterst√ºtzen und die Integration beider Perspektiven f√∂rdern.\n‚Ä¢ Ressourcenoptimierung: Nutzung von Synergien zwischen RWA-Berechnungsprozessen und anderen Risikomanagementaktivit√§ten, um Effizienzgewinne zu realisieren und gleichzeitig die Qualit√§t beider Funktionen zu verbessern."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 2),
        question: "Welche Rolle spielen Stresstests und Szenarioanalysen bei der RWA-Optimierung und wie k√∂nnen Banken diese effektiv in ihre Kapitalplanungsprozesse integrieren?",
        answer: "Stresstests und Szenarioanalysen haben sich von regulatorischen Pflicht√ºbungen zu strategischen Instrumenten der vorausschauenden Kapitalplanung entwickelt. Im Kontext der RWA-Optimierung bieten sie nicht nur Einblicke in potenzielle Risiken, sondern auch wertvolle Erkenntnisse f√ºr die Gestaltung effizienter, widerstandsf√§higer Kapitalstrukturen. Die systematische Integration in die Kapitalplanungsprozesse schafft einen strategischen Mehrwert, der √ºber die reine Compliance-Funktion hinausgeht.\n\nüî¨ Mehrwertdimensionen von Stresstests f√ºr die RWA-Optimierung:\n‚Ä¢ Sensitivit√§tsanalysen f√ºr Methodikentscheidungen: Stresstests erm√∂glichen die Bewertung verschiedener RWA-Berechnungsans√§tze unter adversen Bedingungen, wodurch die Robustheit und Kapitaleffizienz alternativer Methodiken vergleichend beurteilt werden kann.\n‚Ä¢ Identifikation struktureller RWA-Treiber: Durch die Simulation verschiedener Stressszenarien werden jene Portfoliosegmente und Risikofaktoren sichtbar, die unter Stress √ºberproportional zu RWA-Anstiegen beitragen und somit potenzielle Optimierungsschwerpunkte darstellen.\n‚Ä¢ Pr√§ventive Kapitalallokation: Die Erkenntnisse aus Stresstests k√∂nnen genutzt werden, um Kapital proaktiv in jene Gesch√§ftsbereiche zu lenken, die unter Stressbedingungen eine h√∂here Resilienz und geringere RWA-Volatilit√§t aufweisen.\n‚Ä¢ Validierung interner Modelle: Stresstests dienen als wichtiges Validierungsinstrument f√ºr interne RWA-Berechnungsmodelle, indem sie deren Verhalten unter extremen, aber plausiblen Bedingungen pr√ºfen und potenzielle Modellschw√§chen aufdecken.\n\nüîÑ Integration in den Kapitalplanungsprozess:\n‚Ä¢ Forward-Looking Kapitalplanung: Entwicklung eines mehrj√§hrigen Kapitalplanungsansatzes, der nicht nur erwartete Gesch√§ftsentwicklungen, sondern auch Stressszenarien ber√ºcksichtigt und dadurch eine antizipative Kapitalsteuerung erm√∂glicht.\n‚Ä¢ Reverse Stress Testing: Identifikation jener Szenarien, die die Kapitalquoten des Instituts unter kritische Schwellenwerte dr√ºcken w√ºrden, und Ableitung gezielter Ma√ünahmen zur Adressierung der damit verbundenen Vulnerabilit√§ten in der RWA-Struktur.\n‚Ä¢ Capital Actions Framework: Etablierung eines strukturierten Rahmenwerks, das vorab definiert, welche kapitalrelevanten Ma√ünahmen (z.B. Portfolioumschichtungen, Kapitalmarktransaktionen) bei bestimmten Stressereignissen und RWA-Entwicklungen ausgel√∂st werden.\n‚Ä¢ Strategische Szenarioplanung: Erweiterung klassischer regulatorischer Stressszenarien um institutsspezifische, strategierelevante Szenarien, die besondere Herausforderungen oder Chancen f√ºr das Gesch√§ftsmodell abbilden.\n\nüìä Methodische Erfolgsfaktoren:\n‚Ä¢ Granulare RWA-Projektion: Entwicklung fortschrittlicher Projektionsmodelle, die RWA-Effekte auf detaillierter Portfolioebene unter verschiedenen makro√∂konomischen und idiosynkratischen Stressszenarien simulieren k√∂nnen.\n‚Ä¢ Integrierte IT-Infrastruktur: Implementierung einer leistungsf√§higen technologischen Infrastruktur, die sowohl die Stresstest-Berechnungen als auch die regul√§re RWA-Kalkulation unterst√ºtzt und konsistente Ergebnisse √ºber verschiedene Anwendungsf√§lle hinweg gew√§hrleistet.\n‚Ä¢ Qualitative Overlays: Erg√§nzung quantitativer Modelle durch strukturierte qualitative Expertenbewertungen, insbesondere f√ºr schwer quantifizierbare Risiken oder neuartige Stressszenarien, f√ºr die historische Daten begrenzt sind.\n‚Ä¢ Dynamische Simulation: Ber√ºcksichtigung dynamischer Effekte in Stressszenarien, wie Management-Ma√ünahmen, Marktreaktionen oder regulatorische Anpassungen, die den RWA-Verlauf nach dem initialen Stress beeinflussen k√∂nnen."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 3),
        question: "Wie sieht ein effektives Reporting und Monitoring von RWA-Kennzahlen aus und welche Best Practices empfiehlt ADVISORI f√ºr die Management-Kommunikation?",
        answer: "Ein effektives RWA-Reporting und -Monitoring geht weit √ºber die reine Erf√ºllung regulatorischer Anforderungen hinaus. Es stellt ein strategisches Steuerungsinstrument dar, das Entscheidungstr√§gern auf verschiedenen Ebenen die richtigen Informationen in der richtigen Form und zum richtigen Zeitpunkt zur Verf√ºgung stellt. Die Gestaltung dieses Reportings erfordert ein tiefes Verst√§ndnis sowohl der technischen Aspekte der RWA-Berechnung als auch der Informationsbed√ºrfnisse der unterschiedlichen Stakeholder.\n\nüìã Strukturelemente eines optimalen RWA-Reporting-Frameworks:\n‚Ä¢ Mehrdimensionale Berichtsarchitektur: Entwicklung eines abgestuften Reportingsystems mit unterschiedlichen Granularit√§tsebenen ‚Äì von hoch verdichteten Executive Dashboards f√ºr Vorstand und Aufsichtsrat bis hin zu detaillierten operativen Reports f√ºr Fachabteilungen.\n‚Ä¢ Zeitnahe Verf√ºgbarkeit: Implementation von Fast-Close-Prozessen f√ºr RWA-Kennzahlen, die eine zeitnahe Verf√ºgbarkeit der Daten sicherstellen und dadurch ein proaktives Management erm√∂glichen, anstatt nur retrospektive Analysen zu erlauben.\n‚Ä¢ Drill-Down-Funktionalit√§t: Integrierte M√∂glichkeit, von aggregierten KPIs zu ihren Treibern und Komponenten zu navigieren, um die Ursachen von Ver√§nderungen schnell identifizieren und analysieren zu k√∂nnen.\n‚Ä¢ Ampelsystematiken und Schwellenwerte: Definition klarer Toleranzgrenzen und Eskalationsschwellen f√ºr RWA-bezogene KPIs, die fr√ºhzeitig auf potenzielle Probleme hinweisen und klare Handlungsimpulse geben.\n\nüîÑ Kontinuierliches Monitoring und Alert-Mechanismen:\n‚Ä¢ Proaktives Limit-Monitoring: Kontinuierliche √úberwachung der RWA-Nutzung gegen√ºber definierten Limits auf verschiedenen Ebenen (Gesamtbank, Gesch√§ftsbereiche, Portfolios) mit automatisierten Warnsignalen bei Ann√§herung an kritische Schwellenwerte.\n‚Ä¢ Vorhersagemodelle: Integration pr√§diktiver Analysen, die auf Basis aktueller Entwicklungen und geplanter Gesch√§ftsaktivit√§ten zuk√ºnftige RWA-Entwicklungen prognostizieren und potenzielle Engp√§sse fr√ºhzeitig identifizieren.\n‚Ä¢ Intraday-Monitoring f√ºr volatile Risikokategorien: Implementation von Echtzeit- oder Near-Realtime-Monitoring f√ºr besonders volatile RWA-Komponenten, insbesondere im Handelsbereich, um zeitnah auf Marktver√§nderungen reagieren zu k√∂nnen.\n‚Ä¢ Trigger-basierte Reviews: Etablierung automatischer tiefergehender Analysen, die bei signifikanten Ver√§nderungen oder unerwarteten Entwicklungen ausgel√∂st werden, um deren Ursachen zeitnah zu verstehen.\n\nüì± Management-Kommunikation und Wissenstransfer:\n‚Ä¢ Kundenspezifische Reportingformate: Gestaltung von Berichtsformaten, die auf die spezifischen Informationsbed√ºrfnisse und Pr√§ferenzen der verschiedenen Stakeholder zugeschnitten sind ‚Äì von technisch detaillierten Berichten f√ºr Risikokomitees bis hin zu strategisch fokussierten Zusammenfassungen f√ºr den Vorstand.\n‚Ä¢ Visuelle Kommunikation: Nutzung moderner Visualisierungstechniken, die komplexe RWA-Zusammenh√§nge intuitiv verst√§ndlich machen und Muster sowie Trends hervorheben, die in tabellarischen Darstellungen m√∂glicherweise verborgen bleiben.\n‚Ä¢ Narrative Elemente: Erg√§nzung quantitativer Daten durch qualitative Erl√§uterungen, die den Kontext liefern, Entwicklungen erkl√§ren und konkrete Handlungsempfehlungen ableiten.\n‚Ä¢ Interaktive Formate: Bereitstellung interaktiver Dashboards und Self-Service-Analysem√∂glichkeiten, die es Entscheidungstr√§gern erm√∂glichen, flexibel auf die f√ºr sie relevanten Aspekte zu fokussieren und Ad-hoc-Analysen durchzuf√ºhren.\n\nüîç ADVISORI Best Practice-Empfehlungen:\n‚Ä¢ Integriertes Risk and Finance Reporting: √úberwindung von Silostrukturen durch Integration von RWA-Reporting mit anderen Finanz- und Risikokennzahlen, um eine ganzheitliche Sicht auf Performance und Risiko zu erm√∂glichen.\n‚Ä¢ Regulatory-Change Impact Analysis: Systematische Bewertung der Auswirkungen neuer regulatorischer Anforderungen auf RWA-Kennzahlen und proaktive Kommunikation dieser Effekte an relevante Stakeholder.\n‚Ä¢ Peer Benchmarking: Integration von Marktvergleichsdaten in das interne Reporting, um die eigene Position im Wettbewerbsumfeld zu verdeutlichen und Best Practices zu identifizieren.\n‚Ä¢ Schulungs- und Kommunikationsprogramme: Durchf√ºhrung regelm√§√üiger Schulungen f√ºr Fach- und F√ºhrungskr√§fte, um das Verst√§ndnis f√ºr RWA-Treiber und deren Management zu f√∂rdern und eine risikobewusste Unternehmenskultur zu st√§rken."
      },
      {
        _type: 'object',
        _key: generateKey('faq', 4),
        question: "Wie k√∂nnen Finanzinstitute ihre RWA-Optimierung im Spannungsfeld zwischen regulatorischen und √∂konomischen Kapitalanforderungen gestalten?",
        answer: "Die Optimierung risikogewichteter Aktiva (RWA) bewegt sich im Spannungsfeld zwischen regulatorischen Anforderungen (Pillar 1) und √∂konomischer Risikobewertung (ICAAP/Pillar 2). Erfolgreiche Institute entwickeln integrierte Ans√§tze, die beide Perspektiven ber√ºcksichtigen und gleichzeitig die Gesch√§ftsstrategie unterst√ºtzen. Dabei geht es nicht nur um die Minimierung von Kapitalanforderungen, sondern um die Schaffung eines nachhaltigen Gleichgewichts zwischen regulatorischer Compliance, √∂konomischer Effizienz und strategischer Ausrichtung.\n\n‚öñÔ∏è Balance zwischen regulatorischen und √∂konomischen Anforderungen:\n‚Ä¢ Gap-Analyse der Kapitalbedarfe: Systematische Identifikation und Analyse der Unterschiede zwischen regulatorischem und √∂konomischem Kapitalbedarf auf granularer Basis (Risikokategorien, Portfolios, Einzelgesch√§fte) als Grundlage f√ºr zielgerichtete Optimierungsma√ünahmen.\n‚Ä¢ Integrated Capital Planning: Entwicklung eines integrierten Kapitalplanungsansatzes, der sowohl regulatorische als auch √∂konomische Kapitalanforderungen ber√ºcksichtigt und deren Entwicklung unter verschiedenen Szenarien (Base Case, Adverse Case) projiziert.\n‚Ä¢ Risk Appetite Framework Integration: Verkn√ºpfung der RWA-Steuerung mit dem institutionellen Risk Appetite Framework, um sicherzustellen, dass Optimierungsma√ünahmen mit der risikopolitischen Grundausrichtung des Instituts im Einklang stehen.\n‚Ä¢ Total Capital View: Betrachtung der Gesamtkapitalposition √ºber alle S√§ulen hinweg (Pillar 1, Pillar 2, Puffer, MREL/TLAC), um potenzielle Engp√§sse fr√ºhzeitig zu identifizieren und gezielte Optimierungsma√ünahmen abzuleiten.\n\nüß© Strategische Optimierungsans√§tze im dualen System:\n‚Ä¢ Methodische Harmonisierung: Anpassung interner √∂konomischer Kapitalmodelle und -parameter an regulatorische Anforderungen, wo dies √∂konomisch sinnvoll ist, um Inkonsistenzen und methodische Friktionen zu reduzieren.\n‚Ä¢ Portfoliooptimierung: Gezielte Umstrukturierung von Portfolios, um Bereiche zu adressieren, in denen signifikante Diskrepanzen zwischen regulatorischen und √∂konomischen Kapitalanforderungen bestehen, z.B. durch Fokussierung auf Gesch√§fte mit ausgewogenen Anforderungen in beiden Dimensionen.\n‚Ä¢ Risikotransferstrategien: Implementierung von Risikotransferinstrumenten (z.B. Kreditversicherungen, Verbriefungen, Kreditderivate), die sowohl regulatorische als auch √∂konomische Kapitalentlastung bieten, unter sorgf√§ltiger Abw√§gung von Kosten und Nutzen.\n‚Ä¢ Capital Structure Optimization: Anpassung der Kapitalstruktur an die spezifischen Anforderungen von regulatorischem und √∂konomischem Kapital, z.B. durch ma√ügeschneiderte Kapitalinstrumente, die beide Perspektiven adressieren.\n\nüìù Best Practice-Implementierungsansatz:\n‚Ä¢ Duale Steuerungsmetrik: Entwicklung und Implementierung einer integrierten Steuerungsmetrik (z.B. RAROC auf Basis des h√∂heren Werts aus regulatorischem und √∂konomischem Kapital), die beide Dimensionen ber√ºcksichtigt und in Entscheidungsprozesse einbindet.\n‚Ä¢ Process Alignment: Synchronisierung der Prozesse und Zeitpl√§ne f√ºr regulatorische und √∂konomische Kapitalberechnung und -planung, um Synergien zu nutzen und konsistente Entscheidungsgrundlagen zu schaffen.\n‚Ä¢ Technology Integration: Implementierung integrierter Systeme, die sowohl regulatorische als auch √∂konomische Kapitalberechnungen unterst√ºtzen und flexible Analysen aus beiden Perspektiven erm√∂glichen.\n‚Ä¢ Scenario-based Joint Analysis: Durchf√ºhrung kombinierter Szenarioanalysen, die die Auswirkungen verschiedener Gesch√§fts- und Markentwicklungen auf beide Kapitalregime gleichzeitig bewerten und optimale Handlungsoptionen identifizieren.\n\nüéØ Pragmatische Vorgehensweise f√ºr Institute unterschiedlicher Gr√∂√üe:\n‚Ä¢ Gro√üe, komplexe Institute: Entwicklung vollst√§ndig integrierter Risiko- und Kapitalmodelle mit granularen Allokationsmechanismen f√ºr regulatorisches und √∂konomisches Kapital bis auf Transaktionsebene.\n‚Ä¢ Mittelgro√üe Institute: Fokussierung auf ausgew√§hlte Portfolios mit signifikanten Diskrepanzen zwischen regulatorischen und √∂konomischen Anforderungen, w√§hrend f√ºr weniger materielle Bereiche vereinfachte Ans√§tze angewendet werden.\n‚Ä¢ Kleinere Institute: Pragmatische Nutzung regulatorischer Modelle als Approximation f√ºr √∂konomisches Kapital mit gezielten Anpassungen in Bereichen, wo wesentliche Risikodifferenzen bestehen."
      }
    ]
    
    // Update the document with new FAQs
    const updatedFaqs = [...(existingDoc.faq || []), ...newFaqs]
    
    console.log(`Adding ${newFaqs.length} new FAQs to the document...`)
    const transaction = client.transaction()
    transaction.patch(existingDoc._id, {
      set: {
        faq: updatedFaqs
      }
    })
    
    await transaction.commit()
    console.log('‚úÖ FAQs batch 3 added successfully')
  } catch (error) {
    console.error('Error:', error)
    throw error
  }
}

run()
